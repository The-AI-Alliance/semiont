{
  "openapi": "3.0.0",
  "info": {
    "title": "Semiont API",
    "version": "0.1.0",
    "description": "Semantic Knowledge Platform API"
  },
  "servers": [
    {
      "url": "http://localhost:4000",
      "description": "API Server"
    }
  ],
  "components": {
    "schemas": {},
    "parameters": {}
  },
  "paths": {
    "/api/health": {
      "get": {
        "summary": "Health Check",
        "description": "Check if the API is operational and database is connected",
        "tags": [
          "System"
        ],
        "responses": {
          "200": {
            "description": "Health status of the API",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string"
                    },
                    "message": {
                      "type": "string"
                    },
                    "version": {
                      "type": "string"
                    },
                    "timestamp": {
                      "type": "string"
                    },
                    "database": {
                      "type": "string",
                      "enum": [
                        "connected",
                        "disconnected",
                        "unknown"
                      ]
                    },
                    "environment": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "status",
                    "message",
                    "version",
                    "timestamp",
                    "database",
                    "environment"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/tokens/local": {
      "post": {
        "summary": "Local Development Authentication",
        "description": "Authenticate with email only (development mode only)",
        "tags": [
          "Authentication"
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email"
                  }
                },
                "required": [
                  "email"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful authentication",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "user": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "email": {
                          "type": "string"
                        },
                        "name": {
                          "type": [
                            "string",
                            "null"
                          ]
                        },
                        "image": {
                          "type": [
                            "string",
                            "null"
                          ]
                        },
                        "domain": {
                          "type": "string"
                        },
                        "isAdmin": {
                          "type": "boolean"
                        }
                      },
                      "required": [
                        "id",
                        "email",
                        "name",
                        "image",
                        "domain",
                        "isAdmin"
                      ]
                    },
                    "token": {
                      "type": "string"
                    },
                    "isNewUser": {
                      "type": "boolean"
                    }
                  },
                  "required": [
                    "success",
                    "user",
                    "token",
                    "isNewUser"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "code": {
                      "type": "string"
                    },
                    "details": {}
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Local auth not enabled",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "code": {
                      "type": "string"
                    },
                    "details": {}
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/tokens/google": {
      "post": {
        "summary": "Google OAuth Authentication",
        "description": "Authenticate with Google OAuth access token",
        "tags": [
          "Authentication"
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "access_token": {
                    "type": "string"
                  }
                },
                "required": [
                  "access_token"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful authentication",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "user": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "email": {
                          "type": "string"
                        },
                        "name": {
                          "type": [
                            "string",
                            "null"
                          ]
                        },
                        "image": {
                          "type": [
                            "string",
                            "null"
                          ]
                        },
                        "domain": {
                          "type": "string"
                        },
                        "isAdmin": {
                          "type": "boolean"
                        }
                      },
                      "required": [
                        "id",
                        "email",
                        "name",
                        "image",
                        "domain",
                        "isAdmin"
                      ]
                    },
                    "token": {
                      "type": "string"
                    },
                    "isNewUser": {
                      "type": "boolean"
                    }
                  },
                  "required": [
                    "success",
                    "user",
                    "token",
                    "isNewUser"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid request or authentication failed",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "code": {
                      "type": "string"
                    },
                    "details": {}
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/tokens/refresh": {
      "post": {
        "summary": "Refresh Access Token",
        "description": "Exchange a refresh token for a new access token",
        "tags": [
          "Authentication"
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "refreshToken": {
                    "type": "string",
                    "example": "eyJhbGciOiJIUzI1NiIs...",
                    "description": "Refresh token obtained during login"
                  }
                },
                "required": [
                  "refreshToken"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "New access token generated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "access_token": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "access_token"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Invalid or expired refresh token",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "code": {
                      "type": "string"
                    },
                    "details": {}
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/tokens/mcp-generate": {
      "post": {
        "summary": "Generate MCP Token",
        "description": "Generate a short-lived token for MCP server",
        "tags": [
          "Authentication"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "MCP token generated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "refresh_token": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "refresh_token"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "code": {
                      "type": "string"
                    },
                    "details": {}
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/users/me": {
      "get": {
        "summary": "Get Current User",
        "description": "Get information about the authenticated user",
        "tags": [
          "Users"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "User information",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string"
                    },
                    "email": {
                      "type": "string"
                    },
                    "name": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "image": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "domain": {
                      "type": "string"
                    },
                    "provider": {
                      "type": "string"
                    },
                    "isAdmin": {
                      "type": "boolean"
                    },
                    "isActive": {
                      "type": "boolean"
                    },
                    "termsAcceptedAt": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "lastLogin": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "created": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "id",
                    "email",
                    "name",
                    "image",
                    "domain",
                    "provider",
                    "isAdmin",
                    "isActive",
                    "termsAcceptedAt",
                    "lastLogin",
                    "created"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "code": {
                      "type": "string"
                    },
                    "details": {}
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/users/accept-terms": {
      "post": {
        "summary": "Accept Terms",
        "description": "Mark terms as accepted for the current user",
        "tags": [
          "Users"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Terms accepted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "success",
                    "message"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "code": {
                      "type": "string"
                    },
                    "details": {}
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/users/logout": {
      "post": {
        "summary": "Logout",
        "description": "Logout the current user",
        "tags": [
          "Users"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Logged out successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "success",
                    "message"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/status": {
      "get": {
        "summary": "Get Service Status",
        "description": "Get service status and feature availability",
        "tags": [
          "General"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Service status information",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string"
                    },
                    "version": {
                      "type": "string"
                    },
                    "features": {
                      "type": "object",
                      "properties": {
                        "semanticContent": {
                          "type": "string"
                        },
                        "collaboration": {
                          "type": "string"
                        },
                        "rbac": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "semanticContent",
                        "collaboration",
                        "rbac"
                      ]
                    },
                    "message": {
                      "type": "string"
                    },
                    "authenticatedAs": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "status",
                    "version",
                    "features",
                    "message"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "code": {
                      "type": "string"
                    },
                    "details": {}
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/admin/users": {
      "get": {
        "summary": "List All Users",
        "description": "Get a list of all users (admin only)",
        "tags": [
          "Admin"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List of users",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "users": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "email": {
                            "type": "string"
                          },
                          "name": {
                            "type": [
                              "string",
                              "null"
                            ]
                          },
                          "image": {
                            "type": [
                              "string",
                              "null"
                            ]
                          },
                          "domain": {
                            "type": "string"
                          },
                          "provider": {
                            "type": "string"
                          },
                          "isAdmin": {
                            "type": "boolean"
                          },
                          "isActive": {
                            "type": "boolean"
                          },
                          "lastLogin": {
                            "type": [
                              "string",
                              "null"
                            ]
                          },
                          "created": {
                            "type": "string"
                          },
                          "updatedAt": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "id",
                          "email",
                          "name",
                          "image",
                          "domain",
                          "provider",
                          "isAdmin",
                          "isActive",
                          "lastLogin",
                          "created",
                          "updatedAt"
                        ]
                      }
                    }
                  },
                  "required": [
                    "success",
                    "users"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "code": {
                      "type": "string"
                    },
                    "details": {}
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Admin access required",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "code": {
                      "type": "string"
                    },
                    "details": {}
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/admin/users/stats": {
      "get": {
        "summary": "User Statistics",
        "description": "Get user statistics (admin only)",
        "tags": [
          "Admin"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "User statistics",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "stats": {
                      "type": "object",
                      "properties": {
                        "totalUsers": {
                          "type": "number"
                        },
                        "activeUsers": {
                          "type": "number"
                        },
                        "adminUsers": {
                          "type": "number"
                        },
                        "regularUsers": {
                          "type": "number"
                        },
                        "domainBreakdown": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "domain": {
                                "type": "string"
                              },
                              "count": {
                                "type": "number"
                              }
                            },
                            "required": [
                              "domain",
                              "count"
                            ]
                          }
                        },
                        "recentSignups": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "name": {
                                "type": [
                                  "string",
                                  "null"
                                ]
                              },
                              "created": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "email",
                              "name",
                              "created"
                            ]
                          }
                        }
                      },
                      "required": [
                        "totalUsers",
                        "activeUsers",
                        "adminUsers",
                        "regularUsers",
                        "domainBreakdown",
                        "recentSignups"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "stats"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "code": {
                      "type": "string"
                    },
                    "details": {}
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Admin access required",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "code": {
                      "type": "string"
                    },
                    "details": {}
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/admin/users/{id}": {
      "patch": {
        "summary": "Update User",
        "description": "Update user properties (admin only)",
        "tags": [
          "Admin"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "example": "user-123"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "isAdmin": {
                    "type": "boolean"
                  },
                  "isActive": {
                    "type": "boolean"
                  },
                  "name": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "User updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "user": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "email": {
                          "type": "string"
                        },
                        "name": {
                          "type": [
                            "string",
                            "null"
                          ]
                        },
                        "image": {
                          "type": [
                            "string",
                            "null"
                          ]
                        },
                        "domain": {
                          "type": "string"
                        },
                        "provider": {
                          "type": "string"
                        },
                        "isAdmin": {
                          "type": "boolean"
                        },
                        "isActive": {
                          "type": "boolean"
                        },
                        "lastLogin": {
                          "type": [
                            "string",
                            "null"
                          ]
                        },
                        "created": {
                          "type": "string"
                        },
                        "updatedAt": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "email",
                        "name",
                        "image",
                        "domain",
                        "provider",
                        "isAdmin",
                        "isActive",
                        "lastLogin",
                        "created",
                        "updatedAt"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "user"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "code": {
                      "type": "string"
                    },
                    "details": {}
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "code": {
                      "type": "string"
                    },
                    "details": {}
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Admin access required",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "code": {
                      "type": "string"
                    },
                    "details": {}
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "User not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "code": {
                      "type": "string"
                    },
                    "details": {}
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          }
        }
      },
      "delete": {
        "summary": "Delete User",
        "description": "Delete a user account (admin only, cannot delete own account)",
        "tags": [
          "Admin"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "example": "user-123"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "User deleted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "success",
                    "message"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Cannot delete own account",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "code": {
                      "type": "string"
                    },
                    "details": {}
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "code": {
                      "type": "string"
                    },
                    "details": {}
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Admin access required",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "code": {
                      "type": "string"
                    },
                    "details": {}
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "User not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "code": {
                      "type": "string"
                    },
                    "details": {}
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/admin/oauth/config": {
      "get": {
        "summary": "Get OAuth Configuration",
        "description": "Get OAuth provider configuration (admin only, read-only)",
        "tags": [
          "Admin"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "OAuth configuration",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "providers": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "name": {
                            "type": "string"
                          },
                          "isConfigured": {
                            "type": "boolean"
                          },
                          "clientId": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "name",
                          "isConfigured",
                          "clientId"
                        ]
                      }
                    },
                    "allowedDomains": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  },
                  "required": [
                    "providers",
                    "allowedDomains"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "code": {
                      "type": "string"
                    },
                    "details": {}
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Admin access required",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "code": {
                      "type": "string"
                    },
                    "details": {}
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/documents": {
      "post": {
        "summary": "Create Document",
        "description": "Create a new document",
        "tags": [
          "Documents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 500
                  },
                  "content": {
                    "type": "string"
                  },
                  "format": {
                    "type": "string"
                  },
                  "entityTypes": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "locale": {
                    "type": "string"
                  },
                  "creationMethod": {
                    "type": "string"
                  },
                  "sourceAnnotationId": {
                    "type": "string"
                  },
                  "sourceDocumentId": {
                    "type": "string"
                  }
                },
                "required": [
                  "name",
                  "content",
                  "format",
                  "entityTypes"
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Document created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "document": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "format": {
                          "type": "string"
                        },
                        "archived": {
                          "type": "boolean"
                        },
                        "entityTypes": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "locale": {
                          "type": "string"
                        },
                        "creationMethod": {
                          "type": "string",
                          "enum": [
                            "api",
                            "upload",
                            "ui",
                            "reference",
                            "clone",
                            "generated"
                          ]
                        },
                        "sourceAnnotationId": {
                          "type": "string"
                        },
                        "sourceDocumentId": {
                          "type": "string"
                        },
                        "creator": {
                          "type": "string"
                        },
                        "created": {
                          "type": "string"
                        },
                        "contentChecksum": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "name",
                        "format",
                        "archived",
                        "entityTypes",
                        "creationMethod",
                        "creator",
                        "created",
                        "contentChecksum"
                      ]
                    },
                    "annotations": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "motivation": {
                            "type": "string",
                            "enum": [
                              "assessing",
                              "bookmarking",
                              "classifying",
                              "commenting",
                              "describing",
                              "editing",
                              "highlighting",
                              "identifying",
                              "linking",
                              "moderating",
                              "questioning",
                              "replying",
                              "tagging"
                            ]
                          },
                          "target": {
                            "type": "object",
                            "properties": {
                              "source": {
                                "type": "string"
                              },
                              "selector": {
                                "anyOf": [
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextPositionSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "offset": {
                                        "type": "number"
                                      },
                                      "length": {
                                        "type": "number"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact",
                                      "offset",
                                      "length"
                                    ]
                                  },
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextQuoteSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "prefix": {
                                        "type": "string"
                                      },
                                      "suffix": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact"
                                    ]
                                  },
                                  {
                                    "type": "array",
                                    "items": {
                                      "anyOf": [
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextPositionSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "offset": {
                                              "type": "number"
                                            },
                                            "length": {
                                              "type": "number"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact",
                                            "offset",
                                            "length"
                                          ]
                                        },
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextQuoteSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "prefix": {
                                              "type": "string"
                                            },
                                            "suffix": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                ]
                              }
                            },
                            "required": [
                              "source",
                              "selector"
                            ]
                          },
                          "body": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "enum": [
                                  "TextualBody",
                                  "SpecificResource"
                                ]
                              },
                              "value": {
                                "type": "string"
                              },
                              "format": {
                                "type": "string"
                              },
                              "language": {
                                "type": "string"
                              },
                              "source": {
                                "type": [
                                  "string",
                                  "null"
                                ]
                              },
                              "entityTypes": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                },
                                "default": []
                              }
                            },
                            "required": [
                              "type"
                            ]
                          },
                          "creator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          },
                          "created": {
                            "type": "string"
                          },
                          "modified": {
                            "type": "string"
                          },
                          "generator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          }
                        },
                        "required": [
                          "id",
                          "motivation",
                          "target",
                          "body",
                          "creator",
                          "created"
                        ]
                      }
                    }
                  },
                  "required": [
                    "document",
                    "annotations"
                  ]
                }
              }
            }
          }
        }
      },
      "get": {
        "summary": "List Documents",
        "description": "List all documents with optional filters",
        "tags": [
          "Documents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": [
                "number",
                "null"
              ],
              "default": 0
            },
            "required": false,
            "name": "offset",
            "in": "query"
          },
          {
            "schema": {
              "type": [
                "number",
                "null"
              ],
              "default": 50
            },
            "required": false,
            "name": "limit",
            "in": "query"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": false,
            "name": "entityType",
            "in": "query"
          },
          {
            "schema": {
              "anyOf": [
                {
                  "type": "string",
                  "enum": [
                    "true"
                  ]
                },
                {
                  "type": "string",
                  "enum": [
                    "false"
                  ]
                },
                {
                  "type": "boolean"
                }
              ]
            },
            "required": false,
            "name": "archived",
            "in": "query"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": false,
            "name": "search",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "Documents listed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "documents": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "name": {
                            "type": "string"
                          },
                          "format": {
                            "type": "string"
                          },
                          "archived": {
                            "type": "boolean"
                          },
                          "entityTypes": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "locale": {
                            "type": "string"
                          },
                          "creationMethod": {
                            "type": "string",
                            "enum": [
                              "api",
                              "upload",
                              "ui",
                              "reference",
                              "clone",
                              "generated"
                            ]
                          },
                          "sourceAnnotationId": {
                            "type": "string"
                          },
                          "sourceDocumentId": {
                            "type": "string"
                          },
                          "creator": {
                            "type": "string"
                          },
                          "created": {
                            "type": "string"
                          },
                          "contentChecksum": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "id",
                          "name",
                          "format",
                          "archived",
                          "entityTypes",
                          "creationMethod",
                          "creator",
                          "created",
                          "contentChecksum"
                        ]
                      }
                    },
                    "total": {
                      "type": "number"
                    },
                    "offset": {
                      "type": "number"
                    },
                    "limit": {
                      "type": "number"
                    }
                  },
                  "required": [
                    "documents",
                    "total",
                    "offset",
                    "limit"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/documents/search": {
      "get": {
        "summary": "Search Documents",
        "description": "Search documents by name",
        "tags": [
          "Documents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "minLength": 1
            },
            "required": true,
            "name": "q",
            "in": "query"
          },
          {
            "schema": {
              "type": [
                "number",
                "null"
              ],
              "default": 10
            },
            "required": false,
            "name": "limit",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "Search results",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "documents": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "name": {
                            "type": "string"
                          },
                          "format": {
                            "type": "string"
                          },
                          "archived": {
                            "type": "boolean"
                          },
                          "entityTypes": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "locale": {
                            "type": "string"
                          },
                          "creationMethod": {
                            "type": "string",
                            "enum": [
                              "api",
                              "upload",
                              "ui",
                              "reference",
                              "clone",
                              "generated"
                            ]
                          },
                          "sourceAnnotationId": {
                            "type": "string"
                          },
                          "sourceDocumentId": {
                            "type": "string"
                          },
                          "creator": {
                            "type": "string"
                          },
                          "created": {
                            "type": "string"
                          },
                          "contentChecksum": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "id",
                          "name",
                          "format",
                          "archived",
                          "entityTypes",
                          "creationMethod",
                          "creator",
                          "created",
                          "contentChecksum"
                        ]
                      }
                    },
                    "total": {
                      "type": "number"
                    },
                    "offset": {
                      "type": "number"
                    },
                    "limit": {
                      "type": "number"
                    }
                  },
                  "required": [
                    "documents",
                    "total",
                    "offset",
                    "limit"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/documents/{id}": {
      "get": {
        "summary": "Get Document",
        "description": "Get a document by ID",
        "tags": [
          "Documents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Document retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "document": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "format": {
                          "type": "string"
                        },
                        "archived": {
                          "type": "boolean"
                        },
                        "entityTypes": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "locale": {
                          "type": "string"
                        },
                        "creationMethod": {
                          "type": "string",
                          "enum": [
                            "api",
                            "upload",
                            "ui",
                            "reference",
                            "clone",
                            "generated"
                          ]
                        },
                        "sourceAnnotationId": {
                          "type": "string"
                        },
                        "sourceDocumentId": {
                          "type": "string"
                        },
                        "creator": {
                          "type": "string"
                        },
                        "created": {
                          "type": "string"
                        },
                        "contentChecksum": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "name",
                        "format",
                        "archived",
                        "entityTypes",
                        "creationMethod",
                        "creator",
                        "created",
                        "contentChecksum"
                      ]
                    },
                    "annotations": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "motivation": {
                            "type": "string",
                            "enum": [
                              "assessing",
                              "bookmarking",
                              "classifying",
                              "commenting",
                              "describing",
                              "editing",
                              "highlighting",
                              "identifying",
                              "linking",
                              "moderating",
                              "questioning",
                              "replying",
                              "tagging"
                            ]
                          },
                          "target": {
                            "type": "object",
                            "properties": {
                              "source": {
                                "type": "string"
                              },
                              "selector": {
                                "anyOf": [
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextPositionSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "offset": {
                                        "type": "number"
                                      },
                                      "length": {
                                        "type": "number"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact",
                                      "offset",
                                      "length"
                                    ]
                                  },
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextQuoteSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "prefix": {
                                        "type": "string"
                                      },
                                      "suffix": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact"
                                    ]
                                  },
                                  {
                                    "type": "array",
                                    "items": {
                                      "anyOf": [
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextPositionSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "offset": {
                                              "type": "number"
                                            },
                                            "length": {
                                              "type": "number"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact",
                                            "offset",
                                            "length"
                                          ]
                                        },
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextQuoteSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "prefix": {
                                              "type": "string"
                                            },
                                            "suffix": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                ]
                              }
                            },
                            "required": [
                              "source",
                              "selector"
                            ]
                          },
                          "body": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "enum": [
                                  "TextualBody",
                                  "SpecificResource"
                                ]
                              },
                              "value": {
                                "type": "string"
                              },
                              "format": {
                                "type": "string"
                              },
                              "language": {
                                "type": "string"
                              },
                              "source": {
                                "type": [
                                  "string",
                                  "null"
                                ]
                              },
                              "entityTypes": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                },
                                "default": []
                              }
                            },
                            "required": [
                              "type"
                            ]
                          },
                          "creator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          },
                          "created": {
                            "type": "string"
                          },
                          "modified": {
                            "type": "string"
                          },
                          "generator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          }
                        },
                        "required": [
                          "id",
                          "motivation",
                          "target",
                          "body",
                          "creator",
                          "created"
                        ]
                      }
                    },
                    "highlights": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "motivation": {
                            "type": "string",
                            "enum": [
                              "assessing",
                              "bookmarking",
                              "classifying",
                              "commenting",
                              "describing",
                              "editing",
                              "highlighting",
                              "identifying",
                              "linking",
                              "moderating",
                              "questioning",
                              "replying",
                              "tagging"
                            ]
                          },
                          "target": {
                            "type": "object",
                            "properties": {
                              "source": {
                                "type": "string"
                              },
                              "selector": {
                                "anyOf": [
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextPositionSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "offset": {
                                        "type": "number"
                                      },
                                      "length": {
                                        "type": "number"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact",
                                      "offset",
                                      "length"
                                    ]
                                  },
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextQuoteSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "prefix": {
                                        "type": "string"
                                      },
                                      "suffix": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact"
                                    ]
                                  },
                                  {
                                    "type": "array",
                                    "items": {
                                      "anyOf": [
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextPositionSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "offset": {
                                              "type": "number"
                                            },
                                            "length": {
                                              "type": "number"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact",
                                            "offset",
                                            "length"
                                          ]
                                        },
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextQuoteSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "prefix": {
                                              "type": "string"
                                            },
                                            "suffix": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                ]
                              }
                            },
                            "required": [
                              "source",
                              "selector"
                            ]
                          },
                          "body": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "enum": [
                                  "TextualBody",
                                  "SpecificResource"
                                ]
                              },
                              "value": {
                                "type": "string"
                              },
                              "format": {
                                "type": "string"
                              },
                              "language": {
                                "type": "string"
                              },
                              "source": {
                                "type": [
                                  "string",
                                  "null"
                                ]
                              },
                              "entityTypes": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                },
                                "default": []
                              }
                            },
                            "required": [
                              "type"
                            ]
                          },
                          "creator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          },
                          "created": {
                            "type": "string"
                          },
                          "modified": {
                            "type": "string"
                          },
                          "generator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          }
                        },
                        "required": [
                          "id",
                          "motivation",
                          "target",
                          "body",
                          "creator",
                          "created"
                        ]
                      }
                    },
                    "references": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "motivation": {
                            "type": "string",
                            "enum": [
                              "assessing",
                              "bookmarking",
                              "classifying",
                              "commenting",
                              "describing",
                              "editing",
                              "highlighting",
                              "identifying",
                              "linking",
                              "moderating",
                              "questioning",
                              "replying",
                              "tagging"
                            ]
                          },
                          "target": {
                            "type": "object",
                            "properties": {
                              "source": {
                                "type": "string"
                              },
                              "selector": {
                                "anyOf": [
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextPositionSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "offset": {
                                        "type": "number"
                                      },
                                      "length": {
                                        "type": "number"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact",
                                      "offset",
                                      "length"
                                    ]
                                  },
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextQuoteSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "prefix": {
                                        "type": "string"
                                      },
                                      "suffix": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact"
                                    ]
                                  },
                                  {
                                    "type": "array",
                                    "items": {
                                      "anyOf": [
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextPositionSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "offset": {
                                              "type": "number"
                                            },
                                            "length": {
                                              "type": "number"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact",
                                            "offset",
                                            "length"
                                          ]
                                        },
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextQuoteSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "prefix": {
                                              "type": "string"
                                            },
                                            "suffix": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                ]
                              }
                            },
                            "required": [
                              "source",
                              "selector"
                            ]
                          },
                          "body": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "enum": [
                                  "TextualBody",
                                  "SpecificResource"
                                ]
                              },
                              "value": {
                                "type": "string"
                              },
                              "format": {
                                "type": "string"
                              },
                              "language": {
                                "type": "string"
                              },
                              "source": {
                                "type": [
                                  "string",
                                  "null"
                                ]
                              },
                              "entityTypes": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                },
                                "default": []
                              }
                            },
                            "required": [
                              "type"
                            ]
                          },
                          "creator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          },
                          "created": {
                            "type": "string"
                          },
                          "modified": {
                            "type": "string"
                          },
                          "generator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          }
                        },
                        "required": [
                          "id",
                          "motivation",
                          "target",
                          "body",
                          "creator",
                          "created"
                        ]
                      }
                    },
                    "entityReferences": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "motivation": {
                            "type": "string",
                            "enum": [
                              "assessing",
                              "bookmarking",
                              "classifying",
                              "commenting",
                              "describing",
                              "editing",
                              "highlighting",
                              "identifying",
                              "linking",
                              "moderating",
                              "questioning",
                              "replying",
                              "tagging"
                            ]
                          },
                          "target": {
                            "type": "object",
                            "properties": {
                              "source": {
                                "type": "string"
                              },
                              "selector": {
                                "anyOf": [
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextPositionSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "offset": {
                                        "type": "number"
                                      },
                                      "length": {
                                        "type": "number"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact",
                                      "offset",
                                      "length"
                                    ]
                                  },
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextQuoteSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "prefix": {
                                        "type": "string"
                                      },
                                      "suffix": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact"
                                    ]
                                  },
                                  {
                                    "type": "array",
                                    "items": {
                                      "anyOf": [
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextPositionSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "offset": {
                                              "type": "number"
                                            },
                                            "length": {
                                              "type": "number"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact",
                                            "offset",
                                            "length"
                                          ]
                                        },
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextQuoteSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "prefix": {
                                              "type": "string"
                                            },
                                            "suffix": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                ]
                              }
                            },
                            "required": [
                              "source",
                              "selector"
                            ]
                          },
                          "body": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "enum": [
                                  "TextualBody",
                                  "SpecificResource"
                                ]
                              },
                              "value": {
                                "type": "string"
                              },
                              "format": {
                                "type": "string"
                              },
                              "language": {
                                "type": "string"
                              },
                              "source": {
                                "type": [
                                  "string",
                                  "null"
                                ]
                              },
                              "entityTypes": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                },
                                "default": []
                              }
                            },
                            "required": [
                              "type"
                            ]
                          },
                          "creator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          },
                          "created": {
                            "type": "string"
                          },
                          "modified": {
                            "type": "string"
                          },
                          "generator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          }
                        },
                        "required": [
                          "id",
                          "motivation",
                          "target",
                          "body",
                          "creator",
                          "created"
                        ]
                      }
                    }
                  },
                  "required": [
                    "document",
                    "annotations",
                    "highlights",
                    "references",
                    "entityReferences"
                  ]
                }
              }
            }
          }
        }
      },
      "patch": {
        "summary": "Update Document",
        "description": "Update document metadata (append-only operations - name and content are immutable)",
        "tags": [
          "Documents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "entityTypes": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "archived": {
                    "type": "boolean"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Document updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "document": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "format": {
                          "type": "string"
                        },
                        "archived": {
                          "type": "boolean"
                        },
                        "entityTypes": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "locale": {
                          "type": "string"
                        },
                        "creationMethod": {
                          "type": "string",
                          "enum": [
                            "api",
                            "upload",
                            "ui",
                            "reference",
                            "clone",
                            "generated"
                          ]
                        },
                        "sourceAnnotationId": {
                          "type": "string"
                        },
                        "sourceDocumentId": {
                          "type": "string"
                        },
                        "creator": {
                          "type": "string"
                        },
                        "created": {
                          "type": "string"
                        },
                        "contentChecksum": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "name",
                        "format",
                        "archived",
                        "entityTypes",
                        "creationMethod",
                        "creator",
                        "created",
                        "contentChecksum"
                      ]
                    },
                    "annotations": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "motivation": {
                            "type": "string",
                            "enum": [
                              "assessing",
                              "bookmarking",
                              "classifying",
                              "commenting",
                              "describing",
                              "editing",
                              "highlighting",
                              "identifying",
                              "linking",
                              "moderating",
                              "questioning",
                              "replying",
                              "tagging"
                            ]
                          },
                          "target": {
                            "type": "object",
                            "properties": {
                              "source": {
                                "type": "string"
                              },
                              "selector": {
                                "anyOf": [
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextPositionSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "offset": {
                                        "type": "number"
                                      },
                                      "length": {
                                        "type": "number"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact",
                                      "offset",
                                      "length"
                                    ]
                                  },
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextQuoteSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "prefix": {
                                        "type": "string"
                                      },
                                      "suffix": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact"
                                    ]
                                  },
                                  {
                                    "type": "array",
                                    "items": {
                                      "anyOf": [
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextPositionSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "offset": {
                                              "type": "number"
                                            },
                                            "length": {
                                              "type": "number"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact",
                                            "offset",
                                            "length"
                                          ]
                                        },
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextQuoteSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "prefix": {
                                              "type": "string"
                                            },
                                            "suffix": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                ]
                              }
                            },
                            "required": [
                              "source",
                              "selector"
                            ]
                          },
                          "body": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "enum": [
                                  "TextualBody",
                                  "SpecificResource"
                                ]
                              },
                              "value": {
                                "type": "string"
                              },
                              "format": {
                                "type": "string"
                              },
                              "language": {
                                "type": "string"
                              },
                              "source": {
                                "type": [
                                  "string",
                                  "null"
                                ]
                              },
                              "entityTypes": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                },
                                "default": []
                              }
                            },
                            "required": [
                              "type"
                            ]
                          },
                          "creator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          },
                          "created": {
                            "type": "string"
                          },
                          "modified": {
                            "type": "string"
                          },
                          "generator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          }
                        },
                        "required": [
                          "id",
                          "motivation",
                          "target",
                          "body",
                          "creator",
                          "created"
                        ]
                      }
                    },
                    "highlights": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "motivation": {
                            "type": "string",
                            "enum": [
                              "assessing",
                              "bookmarking",
                              "classifying",
                              "commenting",
                              "describing",
                              "editing",
                              "highlighting",
                              "identifying",
                              "linking",
                              "moderating",
                              "questioning",
                              "replying",
                              "tagging"
                            ]
                          },
                          "target": {
                            "type": "object",
                            "properties": {
                              "source": {
                                "type": "string"
                              },
                              "selector": {
                                "anyOf": [
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextPositionSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "offset": {
                                        "type": "number"
                                      },
                                      "length": {
                                        "type": "number"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact",
                                      "offset",
                                      "length"
                                    ]
                                  },
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextQuoteSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "prefix": {
                                        "type": "string"
                                      },
                                      "suffix": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact"
                                    ]
                                  },
                                  {
                                    "type": "array",
                                    "items": {
                                      "anyOf": [
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextPositionSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "offset": {
                                              "type": "number"
                                            },
                                            "length": {
                                              "type": "number"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact",
                                            "offset",
                                            "length"
                                          ]
                                        },
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextQuoteSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "prefix": {
                                              "type": "string"
                                            },
                                            "suffix": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                ]
                              }
                            },
                            "required": [
                              "source",
                              "selector"
                            ]
                          },
                          "body": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "enum": [
                                  "TextualBody",
                                  "SpecificResource"
                                ]
                              },
                              "value": {
                                "type": "string"
                              },
                              "format": {
                                "type": "string"
                              },
                              "language": {
                                "type": "string"
                              },
                              "source": {
                                "type": [
                                  "string",
                                  "null"
                                ]
                              },
                              "entityTypes": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                },
                                "default": []
                              }
                            },
                            "required": [
                              "type"
                            ]
                          },
                          "creator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          },
                          "created": {
                            "type": "string"
                          },
                          "modified": {
                            "type": "string"
                          },
                          "generator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          }
                        },
                        "required": [
                          "id",
                          "motivation",
                          "target",
                          "body",
                          "creator",
                          "created"
                        ]
                      }
                    },
                    "references": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "motivation": {
                            "type": "string",
                            "enum": [
                              "assessing",
                              "bookmarking",
                              "classifying",
                              "commenting",
                              "describing",
                              "editing",
                              "highlighting",
                              "identifying",
                              "linking",
                              "moderating",
                              "questioning",
                              "replying",
                              "tagging"
                            ]
                          },
                          "target": {
                            "type": "object",
                            "properties": {
                              "source": {
                                "type": "string"
                              },
                              "selector": {
                                "anyOf": [
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextPositionSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "offset": {
                                        "type": "number"
                                      },
                                      "length": {
                                        "type": "number"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact",
                                      "offset",
                                      "length"
                                    ]
                                  },
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextQuoteSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "prefix": {
                                        "type": "string"
                                      },
                                      "suffix": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact"
                                    ]
                                  },
                                  {
                                    "type": "array",
                                    "items": {
                                      "anyOf": [
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextPositionSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "offset": {
                                              "type": "number"
                                            },
                                            "length": {
                                              "type": "number"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact",
                                            "offset",
                                            "length"
                                          ]
                                        },
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextQuoteSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "prefix": {
                                              "type": "string"
                                            },
                                            "suffix": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                ]
                              }
                            },
                            "required": [
                              "source",
                              "selector"
                            ]
                          },
                          "body": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "enum": [
                                  "TextualBody",
                                  "SpecificResource"
                                ]
                              },
                              "value": {
                                "type": "string"
                              },
                              "format": {
                                "type": "string"
                              },
                              "language": {
                                "type": "string"
                              },
                              "source": {
                                "type": [
                                  "string",
                                  "null"
                                ]
                              },
                              "entityTypes": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                },
                                "default": []
                              }
                            },
                            "required": [
                              "type"
                            ]
                          },
                          "creator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          },
                          "created": {
                            "type": "string"
                          },
                          "modified": {
                            "type": "string"
                          },
                          "generator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          }
                        },
                        "required": [
                          "id",
                          "motivation",
                          "target",
                          "body",
                          "creator",
                          "created"
                        ]
                      }
                    },
                    "entityReferences": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "motivation": {
                            "type": "string",
                            "enum": [
                              "assessing",
                              "bookmarking",
                              "classifying",
                              "commenting",
                              "describing",
                              "editing",
                              "highlighting",
                              "identifying",
                              "linking",
                              "moderating",
                              "questioning",
                              "replying",
                              "tagging"
                            ]
                          },
                          "target": {
                            "type": "object",
                            "properties": {
                              "source": {
                                "type": "string"
                              },
                              "selector": {
                                "anyOf": [
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextPositionSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "offset": {
                                        "type": "number"
                                      },
                                      "length": {
                                        "type": "number"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact",
                                      "offset",
                                      "length"
                                    ]
                                  },
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextQuoteSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "prefix": {
                                        "type": "string"
                                      },
                                      "suffix": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact"
                                    ]
                                  },
                                  {
                                    "type": "array",
                                    "items": {
                                      "anyOf": [
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextPositionSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "offset": {
                                              "type": "number"
                                            },
                                            "length": {
                                              "type": "number"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact",
                                            "offset",
                                            "length"
                                          ]
                                        },
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextQuoteSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "prefix": {
                                              "type": "string"
                                            },
                                            "suffix": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                ]
                              }
                            },
                            "required": [
                              "source",
                              "selector"
                            ]
                          },
                          "body": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "enum": [
                                  "TextualBody",
                                  "SpecificResource"
                                ]
                              },
                              "value": {
                                "type": "string"
                              },
                              "format": {
                                "type": "string"
                              },
                              "language": {
                                "type": "string"
                              },
                              "source": {
                                "type": [
                                  "string",
                                  "null"
                                ]
                              },
                              "entityTypes": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                },
                                "default": []
                              }
                            },
                            "required": [
                              "type"
                            ]
                          },
                          "creator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          },
                          "created": {
                            "type": "string"
                          },
                          "modified": {
                            "type": "string"
                          },
                          "generator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          }
                        },
                        "required": [
                          "id",
                          "motivation",
                          "target",
                          "body",
                          "creator",
                          "created"
                        ]
                      }
                    }
                  },
                  "required": [
                    "document",
                    "annotations",
                    "highlights",
                    "references",
                    "entityReferences"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/documents/{id}/content": {
      "get": {
        "summary": "Get Document Content",
        "description": "Get raw content of a document with correct MIME type from document metadata",
        "tags": [
          "Documents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Document content with MIME type from document.format",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              },
              "text/markdown": {
                "schema": {
                  "type": "string"
                }
              },
              "application/pdf": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "/api/documents/from-annotation/{annotationId}": {
      "post": {
        "summary": "Create Document from Annotation",
        "description": "Create a new document from an annotation/reference",
        "tags": [
          "Documents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "annotationId",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "content": {
                    "type": "string"
                  },
                  "format": {
                    "type": "string"
                  },
                  "metadata": {
                    "type": "object",
                    "additionalProperties": {}
                  }
                },
                "required": [
                  "name",
                  "content",
                  "format"
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Document created from annotation",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "document": {},
                    "annotations": {
                      "type": "array",
                      "items": {}
                    }
                  },
                  "required": [
                    "annotations"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/documents/{id}/detect-annotations-stream": {
      "post": {
        "summary": "Detect Annotations with Progress (SSE)",
        "description": "Stream real-time entity detection progress via Server-Sent Events",
        "tags": [
          "Documents",
          "Annotations",
          "Real-time"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "entityTypes": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                },
                "required": [
                  "entityTypes"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "SSE stream opened successfully",
            "content": {
              "text/event-stream": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "event": {
                      "type": "string"
                    },
                    "data": {
                      "type": "string"
                    },
                    "id": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "event",
                    "data"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Authentication required"
          },
          "404": {
            "description": "Document not found"
          }
        }
      }
    },
    "/api/documents/{id}/llm-context": {
      "get": {
        "summary": "Get Document LLM Context",
        "description": "Get document with full context for LLM processing",
        "tags": [
          "Documents",
          "AI"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          },
          {
            "schema": {
              "type": "number",
              "minimum": 1,
              "maximum": 3,
              "default": 2
            },
            "required": false,
            "name": "depth",
            "in": "query"
          },
          {
            "schema": {
              "type": "number",
              "minimum": 1,
              "maximum": 20,
              "default": 10
            },
            "required": false,
            "name": "maxDocuments",
            "in": "query"
          },
          {
            "schema": {
              "anyOf": [
                {
                  "type": "string",
                  "enum": [
                    "true"
                  ]
                },
                {
                  "type": "string",
                  "enum": [
                    "false"
                  ]
                },
                {
                  "type": "boolean"
                }
              ],
              "default": true
            },
            "required": false,
            "name": "includeContent",
            "in": "query"
          },
          {
            "schema": {
              "anyOf": [
                {
                  "type": "string",
                  "enum": [
                    "true"
                  ]
                },
                {
                  "type": "string",
                  "enum": [
                    "false"
                  ]
                },
                {
                  "type": "boolean"
                }
              ],
              "default": false
            },
            "required": false,
            "name": "includeSummary",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "LLM context",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "mainDocument": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "format": {
                          "type": "string"
                        },
                        "archived": {
                          "type": "boolean"
                        },
                        "entityTypes": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "locale": {
                          "type": "string"
                        },
                        "creationMethod": {
                          "type": "string",
                          "enum": [
                            "api",
                            "upload",
                            "ui",
                            "reference",
                            "clone",
                            "generated"
                          ]
                        },
                        "sourceAnnotationId": {
                          "type": "string"
                        },
                        "sourceDocumentId": {
                          "type": "string"
                        },
                        "creator": {
                          "type": "string"
                        },
                        "created": {
                          "type": "string"
                        },
                        "contentChecksum": {
                          "type": "string"
                        },
                        "content": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "name",
                        "format",
                        "archived",
                        "entityTypes",
                        "creationMethod",
                        "creator",
                        "created",
                        "contentChecksum"
                      ]
                    },
                    "relatedDocuments": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "name": {
                            "type": "string"
                          },
                          "format": {
                            "type": "string"
                          },
                          "archived": {
                            "type": "boolean"
                          },
                          "entityTypes": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "locale": {
                            "type": "string"
                          },
                          "creationMethod": {
                            "type": "string",
                            "enum": [
                              "api",
                              "upload",
                              "ui",
                              "reference",
                              "clone",
                              "generated"
                            ]
                          },
                          "sourceAnnotationId": {
                            "type": "string"
                          },
                          "sourceDocumentId": {
                            "type": "string"
                          },
                          "creator": {
                            "type": "string"
                          },
                          "created": {
                            "type": "string"
                          },
                          "contentChecksum": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "id",
                          "name",
                          "format",
                          "archived",
                          "entityTypes",
                          "creationMethod",
                          "creator",
                          "created",
                          "contentChecksum"
                        ]
                      }
                    },
                    "annotations": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "motivation": {
                            "type": "string",
                            "enum": [
                              "assessing",
                              "bookmarking",
                              "classifying",
                              "commenting",
                              "describing",
                              "editing",
                              "highlighting",
                              "identifying",
                              "linking",
                              "moderating",
                              "questioning",
                              "replying",
                              "tagging"
                            ]
                          },
                          "target": {
                            "type": "object",
                            "properties": {
                              "source": {
                                "type": "string"
                              },
                              "selector": {
                                "anyOf": [
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextPositionSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "offset": {
                                        "type": "number"
                                      },
                                      "length": {
                                        "type": "number"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact",
                                      "offset",
                                      "length"
                                    ]
                                  },
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextQuoteSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "prefix": {
                                        "type": "string"
                                      },
                                      "suffix": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact"
                                    ]
                                  },
                                  {
                                    "type": "array",
                                    "items": {
                                      "anyOf": [
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextPositionSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "offset": {
                                              "type": "number"
                                            },
                                            "length": {
                                              "type": "number"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact",
                                            "offset",
                                            "length"
                                          ]
                                        },
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextQuoteSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "prefix": {
                                              "type": "string"
                                            },
                                            "suffix": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                ]
                              }
                            },
                            "required": [
                              "source",
                              "selector"
                            ]
                          },
                          "body": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "enum": [
                                  "TextualBody",
                                  "SpecificResource"
                                ]
                              },
                              "value": {
                                "type": "string"
                              },
                              "format": {
                                "type": "string"
                              },
                              "language": {
                                "type": "string"
                              },
                              "source": {
                                "type": [
                                  "string",
                                  "null"
                                ]
                              },
                              "entityTypes": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                },
                                "default": []
                              }
                            },
                            "required": [
                              "type"
                            ]
                          },
                          "creator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          },
                          "created": {
                            "type": "string"
                          },
                          "modified": {
                            "type": "string"
                          },
                          "generator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          }
                        },
                        "required": [
                          "id",
                          "motivation",
                          "target",
                          "body",
                          "creator",
                          "created"
                        ]
                      }
                    },
                    "graph": {
                      "type": "object",
                      "properties": {
                        "nodes": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string"
                              },
                              "label": {
                                "type": "string"
                              },
                              "metadata": {
                                "type": "object",
                                "additionalProperties": {}
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "label",
                              "metadata"
                            ]
                          }
                        },
                        "edges": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "source": {
                                "type": "string"
                              },
                              "target": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string"
                              },
                              "metadata": {
                                "type": "object",
                                "additionalProperties": {}
                              }
                            },
                            "required": [
                              "source",
                              "target",
                              "type",
                              "metadata"
                            ]
                          }
                        }
                      },
                      "required": [
                        "nodes",
                        "edges"
                      ]
                    },
                    "summary": {
                      "type": "string"
                    },
                    "suggestedReferences": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  },
                  "required": [
                    "mainDocument",
                    "relatedDocuments",
                    "annotations",
                    "graph"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/documents/{documentId}/references/{referenceId}/llm-context": {
      "get": {
        "summary": "Get Reference LLM Context",
        "description": "Get reference with full context for LLM processing",
        "tags": [
          "Documents",
          "AI"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "documentId",
            "in": "path"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "referenceId",
            "in": "path"
          },
          {
            "schema": {
              "anyOf": [
                {
                  "type": "string",
                  "enum": [
                    "true"
                  ]
                },
                {
                  "type": "string",
                  "enum": [
                    "false"
                  ]
                },
                {
                  "type": "boolean"
                }
              ],
              "default": true
            },
            "required": false,
            "name": "includeSourceContext",
            "in": "query"
          },
          {
            "schema": {
              "anyOf": [
                {
                  "type": "string",
                  "enum": [
                    "true"
                  ]
                },
                {
                  "type": "string",
                  "enum": [
                    "false"
                  ]
                },
                {
                  "type": "boolean"
                }
              ],
              "default": true
            },
            "required": false,
            "name": "includeTargetContext",
            "in": "query"
          },
          {
            "schema": {
              "type": "number",
              "minimum": 100,
              "maximum": 5000,
              "default": 1000
            },
            "required": false,
            "name": "contextWindow",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "Reference LLM context",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "reference": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "motivation": {
                          "type": "string",
                          "enum": [
                            "assessing",
                            "bookmarking",
                            "classifying",
                            "commenting",
                            "describing",
                            "editing",
                            "highlighting",
                            "identifying",
                            "linking",
                            "moderating",
                            "questioning",
                            "replying",
                            "tagging"
                          ]
                        },
                        "target": {
                          "type": "object",
                          "properties": {
                            "source": {
                              "type": "string"
                            },
                            "selector": {
                              "anyOf": [
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "enum": [
                                        "TextPositionSelector"
                                      ]
                                    },
                                    "exact": {
                                      "type": "string"
                                    },
                                    "offset": {
                                      "type": "number"
                                    },
                                    "length": {
                                      "type": "number"
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "exact",
                                    "offset",
                                    "length"
                                  ]
                                },
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "enum": [
                                        "TextQuoteSelector"
                                      ]
                                    },
                                    "exact": {
                                      "type": "string"
                                    },
                                    "prefix": {
                                      "type": "string"
                                    },
                                    "suffix": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "exact"
                                  ]
                                },
                                {
                                  "type": "array",
                                  "items": {
                                    "anyOf": [
                                      {
                                        "type": "object",
                                        "properties": {
                                          "type": {
                                            "type": "string",
                                            "enum": [
                                              "TextPositionSelector"
                                            ]
                                          },
                                          "exact": {
                                            "type": "string"
                                          },
                                          "offset": {
                                            "type": "number"
                                          },
                                          "length": {
                                            "type": "number"
                                          }
                                        },
                                        "required": [
                                          "type",
                                          "exact",
                                          "offset",
                                          "length"
                                        ]
                                      },
                                      {
                                        "type": "object",
                                        "properties": {
                                          "type": {
                                            "type": "string",
                                            "enum": [
                                              "TextQuoteSelector"
                                            ]
                                          },
                                          "exact": {
                                            "type": "string"
                                          },
                                          "prefix": {
                                            "type": "string"
                                          },
                                          "suffix": {
                                            "type": "string"
                                          }
                                        },
                                        "required": [
                                          "type",
                                          "exact"
                                        ]
                                      }
                                    ]
                                  }
                                }
                              ]
                            }
                          },
                          "required": [
                            "source",
                            "selector"
                          ]
                        },
                        "body": {
                          "type": "object",
                          "properties": {
                            "type": {
                              "type": "string",
                              "enum": [
                                "TextualBody",
                                "SpecificResource"
                              ]
                            },
                            "value": {
                              "type": "string"
                            },
                            "format": {
                              "type": "string"
                            },
                            "language": {
                              "type": "string"
                            },
                            "source": {
                              "type": [
                                "string",
                                "null"
                              ]
                            },
                            "entityTypes": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              },
                              "default": []
                            }
                          },
                          "required": [
                            "type"
                          ]
                        },
                        "creator": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string"
                            },
                            "type": {
                              "type": "string",
                              "enum": [
                                "Person",
                                "Organization",
                                "Software"
                              ]
                            },
                            "name": {
                              "type": "string"
                            },
                            "nickname": {
                              "type": "string"
                            },
                            "email": {
                              "type": "string"
                            },
                            "email_sha1": {
                              "type": "string"
                            },
                            "homepage": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "id",
                            "type",
                            "name"
                          ]
                        },
                        "created": {
                          "type": "string"
                        },
                        "modified": {
                          "type": "string"
                        },
                        "generator": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string"
                            },
                            "type": {
                              "type": "string",
                              "enum": [
                                "Person",
                                "Organization",
                                "Software"
                              ]
                            },
                            "name": {
                              "type": "string"
                            },
                            "nickname": {
                              "type": "string"
                            },
                            "email": {
                              "type": "string"
                            },
                            "email_sha1": {
                              "type": "string"
                            },
                            "homepage": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "id",
                            "type",
                            "name"
                          ]
                        }
                      },
                      "required": [
                        "id",
                        "motivation",
                        "target",
                        "body",
                        "creator",
                        "created"
                      ]
                    },
                    "sourceDocument": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "format": {
                          "type": "string"
                        },
                        "archived": {
                          "type": "boolean"
                        },
                        "entityTypes": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "locale": {
                          "type": "string"
                        },
                        "creationMethod": {
                          "type": "string",
                          "enum": [
                            "api",
                            "upload",
                            "ui",
                            "reference",
                            "clone",
                            "generated"
                          ]
                        },
                        "sourceAnnotationId": {
                          "type": "string"
                        },
                        "sourceDocumentId": {
                          "type": "string"
                        },
                        "creator": {
                          "type": "string"
                        },
                        "created": {
                          "type": "string"
                        },
                        "contentChecksum": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "name",
                        "format",
                        "archived",
                        "entityTypes",
                        "creationMethod",
                        "creator",
                        "created",
                        "contentChecksum"
                      ]
                    },
                    "targetDocument": {
                      "type": [
                        "object",
                        "null"
                      ],
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "format": {
                          "type": "string"
                        },
                        "archived": {
                          "type": "boolean"
                        },
                        "entityTypes": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "locale": {
                          "type": "string"
                        },
                        "creationMethod": {
                          "type": "string",
                          "enum": [
                            "api",
                            "upload",
                            "ui",
                            "reference",
                            "clone",
                            "generated"
                          ]
                        },
                        "sourceAnnotationId": {
                          "type": "string"
                        },
                        "sourceDocumentId": {
                          "type": "string"
                        },
                        "creator": {
                          "type": "string"
                        },
                        "created": {
                          "type": "string"
                        },
                        "contentChecksum": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "name",
                        "format",
                        "archived",
                        "entityTypes",
                        "creationMethod",
                        "creator",
                        "created",
                        "contentChecksum"
                      ]
                    },
                    "sourceContext": {
                      "type": "object",
                      "properties": {
                        "before": {
                          "type": "string"
                        },
                        "selected": {
                          "type": "string"
                        },
                        "after": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "before",
                        "selected",
                        "after"
                      ]
                    },
                    "targetContext": {
                      "type": "object",
                      "properties": {
                        "content": {
                          "type": "string"
                        },
                        "summary": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "content"
                      ]
                    },
                    "suggestedResolution": {
                      "type": "object",
                      "properties": {
                        "documentId": {
                          "type": "string"
                        },
                        "documentName": {
                          "type": "string"
                        },
                        "confidence": {
                          "type": "number"
                        },
                        "reasoning": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "documentId",
                        "documentName",
                        "confidence",
                        "reasoning"
                      ]
                    }
                  },
                  "required": [
                    "reference",
                    "sourceDocument",
                    "targetDocument"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/documents/{id}/referenced-by": {
      "get": {
        "summary": "Get Referenced By",
        "description": "Get documents that reference this document",
        "tags": [
          "Documents",
          "Graph"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Documents that reference this document",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "referencedBy": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string",
                            "description": "Reference annotation ID"
                          },
                          "documentName": {
                            "type": "string",
                            "description": "Name of document containing the reference"
                          },
                          "target": {
                            "type": "object",
                            "properties": {
                              "source": {
                                "type": "string",
                                "description": "ID of document containing the reference"
                              },
                              "selector": {
                                "type": "object",
                                "properties": {
                                  "exact": {
                                    "type": "string",
                                    "description": "The selected text that references this document"
                                  }
                                },
                                "required": [
                                  "exact"
                                ]
                              }
                            },
                            "required": [
                              "source",
                              "selector"
                            ]
                          }
                        },
                        "required": [
                          "id",
                          "documentName",
                          "target"
                        ]
                      }
                    }
                  },
                  "required": [
                    "referencedBy"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/documents/{id}/discover-context": {
      "post": {
        "summary": "Discover Context",
        "description": "Discover related documents and concepts",
        "tags": [
          "Documents",
          "Graph"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "depth": {
                    "type": "number",
                    "minimum": 1,
                    "maximum": 3,
                    "default": 2
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Context discovery results",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "documents": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "name": {
                            "type": "string"
                          },
                          "format": {
                            "type": "string"
                          },
                          "archived": {
                            "type": "boolean"
                          },
                          "entityTypes": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "locale": {
                            "type": "string"
                          },
                          "creationMethod": {
                            "type": "string",
                            "enum": [
                              "api",
                              "upload",
                              "ui",
                              "reference",
                              "clone",
                              "generated"
                            ]
                          },
                          "sourceAnnotationId": {
                            "type": "string"
                          },
                          "sourceDocumentId": {
                            "type": "string"
                          },
                          "creator": {
                            "type": "string"
                          },
                          "created": {
                            "type": "string"
                          },
                          "contentChecksum": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "id",
                          "name",
                          "format",
                          "archived",
                          "entityTypes",
                          "creationMethod",
                          "creator",
                          "created",
                          "contentChecksum"
                        ]
                      }
                    },
                    "connections": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "fromId": {
                            "type": "string"
                          },
                          "toId": {
                            "type": "string"
                          },
                          "type": {
                            "type": "string"
                          },
                          "metadata": {
                            "type": "object",
                            "additionalProperties": {}
                          }
                        },
                        "required": [
                          "fromId",
                          "toId",
                          "type",
                          "metadata"
                        ]
                      }
                    }
                  },
                  "required": [
                    "documents",
                    "connections"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/documents/token/{token}": {
      "get": {
        "summary": "Get Document by Clone Token",
        "description": "Retrieve a document using a clone token",
        "tags": [
          "Documents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "token",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Document retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "sourceDocument": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "format": {
                          "type": "string"
                        },
                        "archived": {
                          "type": "boolean"
                        },
                        "entityTypes": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "locale": {
                          "type": "string"
                        },
                        "creationMethod": {
                          "type": "string",
                          "enum": [
                            "api",
                            "upload",
                            "ui",
                            "reference",
                            "clone",
                            "generated"
                          ]
                        },
                        "sourceAnnotationId": {
                          "type": "string"
                        },
                        "sourceDocumentId": {
                          "type": "string"
                        },
                        "creator": {
                          "type": "string"
                        },
                        "created": {
                          "type": "string"
                        },
                        "contentChecksum": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "name",
                        "format",
                        "archived",
                        "entityTypes",
                        "creationMethod",
                        "creator",
                        "created",
                        "contentChecksum"
                      ]
                    },
                    "expiresAt": {
                      "type": "string",
                      "description": "ISO 8601 timestamp when token expires"
                    }
                  },
                  "required": [
                    "sourceDocument",
                    "expiresAt"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/documents/create-from-token": {
      "post": {
        "summary": "Create Document from Clone Token",
        "description": "Create a new document using a clone token",
        "tags": [
          "Documents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "token": {
                    "type": "string",
                    "description": "Clone token"
                  },
                  "name": {
                    "type": "string",
                    "description": "Name for the new document"
                  },
                  "content": {
                    "type": "string",
                    "description": "Content for the new document"
                  },
                  "archiveOriginal": {
                    "type": "boolean",
                    "description": "Whether to archive the original document"
                  }
                },
                "required": [
                  "token",
                  "name",
                  "content"
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Document created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "document": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "format": {
                          "type": "string"
                        },
                        "archived": {
                          "type": "boolean"
                        },
                        "entityTypes": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "locale": {
                          "type": "string"
                        },
                        "creationMethod": {
                          "type": "string",
                          "enum": [
                            "api",
                            "upload",
                            "ui",
                            "reference",
                            "clone",
                            "generated"
                          ]
                        },
                        "sourceAnnotationId": {
                          "type": "string"
                        },
                        "sourceDocumentId": {
                          "type": "string"
                        },
                        "creator": {
                          "type": "string"
                        },
                        "created": {
                          "type": "string"
                        },
                        "contentChecksum": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "name",
                        "format",
                        "archived",
                        "entityTypes",
                        "creationMethod",
                        "creator",
                        "created",
                        "contentChecksum"
                      ]
                    },
                    "annotations": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "motivation": {
                            "type": "string",
                            "enum": [
                              "assessing",
                              "bookmarking",
                              "classifying",
                              "commenting",
                              "describing",
                              "editing",
                              "highlighting",
                              "identifying",
                              "linking",
                              "moderating",
                              "questioning",
                              "replying",
                              "tagging"
                            ]
                          },
                          "target": {
                            "type": "object",
                            "properties": {
                              "source": {
                                "type": "string"
                              },
                              "selector": {
                                "anyOf": [
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextPositionSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "offset": {
                                        "type": "number"
                                      },
                                      "length": {
                                        "type": "number"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact",
                                      "offset",
                                      "length"
                                    ]
                                  },
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextQuoteSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "prefix": {
                                        "type": "string"
                                      },
                                      "suffix": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact"
                                    ]
                                  },
                                  {
                                    "type": "array",
                                    "items": {
                                      "anyOf": [
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextPositionSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "offset": {
                                              "type": "number"
                                            },
                                            "length": {
                                              "type": "number"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact",
                                            "offset",
                                            "length"
                                          ]
                                        },
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextQuoteSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "prefix": {
                                              "type": "string"
                                            },
                                            "suffix": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                ]
                              }
                            },
                            "required": [
                              "source",
                              "selector"
                            ]
                          },
                          "body": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "enum": [
                                  "TextualBody",
                                  "SpecificResource"
                                ]
                              },
                              "value": {
                                "type": "string"
                              },
                              "format": {
                                "type": "string"
                              },
                              "language": {
                                "type": "string"
                              },
                              "source": {
                                "type": [
                                  "string",
                                  "null"
                                ]
                              },
                              "entityTypes": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                },
                                "default": []
                              }
                            },
                            "required": [
                              "type"
                            ]
                          },
                          "creator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          },
                          "created": {
                            "type": "string"
                          },
                          "modified": {
                            "type": "string"
                          },
                          "generator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          }
                        },
                        "required": [
                          "id",
                          "motivation",
                          "target",
                          "body",
                          "creator",
                          "created"
                        ]
                      }
                    }
                  },
                  "required": [
                    "document",
                    "annotations"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/documents/{id}/clone-with-token": {
      "post": {
        "summary": "Clone Document with Token",
        "description": "Generate a temporary token for cloning a document",
        "tags": [
          "Documents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Clone token generated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "token": {
                      "type": "string",
                      "description": "Generated clone token"
                    },
                    "expiresAt": {
                      "type": "string",
                      "description": "ISO 8601 timestamp when token expires"
                    },
                    "document": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "format": {
                          "type": "string"
                        },
                        "archived": {
                          "type": "boolean"
                        },
                        "entityTypes": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "locale": {
                          "type": "string"
                        },
                        "creationMethod": {
                          "type": "string",
                          "enum": [
                            "api",
                            "upload",
                            "ui",
                            "reference",
                            "clone",
                            "generated"
                          ]
                        },
                        "sourceAnnotationId": {
                          "type": "string"
                        },
                        "sourceDocumentId": {
                          "type": "string"
                        },
                        "creator": {
                          "type": "string"
                        },
                        "created": {
                          "type": "string"
                        },
                        "contentChecksum": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "name",
                        "format",
                        "archived",
                        "entityTypes",
                        "creationMethod",
                        "creator",
                        "created",
                        "contentChecksum"
                      ]
                    }
                  },
                  "required": [
                    "token",
                    "expiresAt",
                    "document"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/documents/{id}/highlights": {
      "get": {
        "summary": "Get Document Highlights",
        "description": "Get only highlights (annotations without body of type SpecifiedResource with a source) in a document",
        "tags": [
          "Documents",
          "Selections"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Document highlights",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "highlights": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "motivation": {
                            "type": "string",
                            "enum": [
                              "assessing",
                              "bookmarking",
                              "classifying",
                              "commenting",
                              "describing",
                              "editing",
                              "highlighting",
                              "identifying",
                              "linking",
                              "moderating",
                              "questioning",
                              "replying",
                              "tagging"
                            ]
                          },
                          "target": {
                            "type": "object",
                            "properties": {
                              "source": {
                                "type": "string"
                              },
                              "selector": {
                                "anyOf": [
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextPositionSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "offset": {
                                        "type": "number"
                                      },
                                      "length": {
                                        "type": "number"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact",
                                      "offset",
                                      "length"
                                    ]
                                  },
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextQuoteSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "prefix": {
                                        "type": "string"
                                      },
                                      "suffix": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact"
                                    ]
                                  },
                                  {
                                    "type": "array",
                                    "items": {
                                      "anyOf": [
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextPositionSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "offset": {
                                              "type": "number"
                                            },
                                            "length": {
                                              "type": "number"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact",
                                            "offset",
                                            "length"
                                          ]
                                        },
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextQuoteSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "prefix": {
                                              "type": "string"
                                            },
                                            "suffix": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                ]
                              }
                            },
                            "required": [
                              "source",
                              "selector"
                            ]
                          },
                          "body": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "enum": [
                                  "TextualBody",
                                  "SpecificResource"
                                ]
                              },
                              "value": {
                                "type": "string"
                              },
                              "format": {
                                "type": "string"
                              },
                              "language": {
                                "type": "string"
                              },
                              "source": {
                                "type": [
                                  "string",
                                  "null"
                                ]
                              },
                              "entityTypes": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                },
                                "default": []
                              }
                            },
                            "required": [
                              "type"
                            ]
                          },
                          "creator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          },
                          "created": {
                            "type": "string"
                          },
                          "modified": {
                            "type": "string"
                          },
                          "generator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          }
                        },
                        "required": [
                          "id",
                          "motivation",
                          "target",
                          "body",
                          "creator",
                          "created"
                        ]
                      }
                    }
                  },
                  "required": [
                    "highlights"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/documents/{id}/references": {
      "get": {
        "summary": "Get Document References",
        "description": "Get only references (annotations with body of type SpecifiedResource with a source) in a document",
        "tags": [
          "Documents",
          "Selections"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Document references",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "references": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "motivation": {
                            "type": "string",
                            "enum": [
                              "assessing",
                              "bookmarking",
                              "classifying",
                              "commenting",
                              "describing",
                              "editing",
                              "highlighting",
                              "identifying",
                              "linking",
                              "moderating",
                              "questioning",
                              "replying",
                              "tagging"
                            ]
                          },
                          "target": {
                            "type": "object",
                            "properties": {
                              "source": {
                                "type": "string"
                              },
                              "selector": {
                                "anyOf": [
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextPositionSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "offset": {
                                        "type": "number"
                                      },
                                      "length": {
                                        "type": "number"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact",
                                      "offset",
                                      "length"
                                    ]
                                  },
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextQuoteSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "prefix": {
                                        "type": "string"
                                      },
                                      "suffix": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact"
                                    ]
                                  },
                                  {
                                    "type": "array",
                                    "items": {
                                      "anyOf": [
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextPositionSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "offset": {
                                              "type": "number"
                                            },
                                            "length": {
                                              "type": "number"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact",
                                            "offset",
                                            "length"
                                          ]
                                        },
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextQuoteSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "prefix": {
                                              "type": "string"
                                            },
                                            "suffix": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                ]
                              }
                            },
                            "required": [
                              "source",
                              "selector"
                            ]
                          },
                          "body": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "enum": [
                                  "TextualBody",
                                  "SpecificResource"
                                ]
                              },
                              "value": {
                                "type": "string"
                              },
                              "format": {
                                "type": "string"
                              },
                              "language": {
                                "type": "string"
                              },
                              "source": {
                                "type": [
                                  "string",
                                  "null"
                                ]
                              },
                              "entityTypes": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                },
                                "default": []
                              }
                            },
                            "required": [
                              "type"
                            ]
                          },
                          "creator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          },
                          "created": {
                            "type": "string"
                          },
                          "modified": {
                            "type": "string"
                          },
                          "generator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          }
                        },
                        "required": [
                          "id",
                          "motivation",
                          "target",
                          "body",
                          "creator",
                          "created"
                        ]
                      }
                    }
                  },
                  "required": [
                    "references"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/documents/{id}/annotations": {
      "get": {
        "summary": "Get Document Annotations",
        "description": "Get all annotations (both highlights and references) in a document",
        "tags": [
          "Documents",
          "Annotations"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Document annotations",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "annotations": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "motivation": {
                            "type": "string",
                            "enum": [
                              "assessing",
                              "bookmarking",
                              "classifying",
                              "commenting",
                              "describing",
                              "editing",
                              "highlighting",
                              "identifying",
                              "linking",
                              "moderating",
                              "questioning",
                              "replying",
                              "tagging"
                            ]
                          },
                          "target": {
                            "type": "object",
                            "properties": {
                              "source": {
                                "type": "string"
                              },
                              "selector": {
                                "anyOf": [
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextPositionSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "offset": {
                                        "type": "number"
                                      },
                                      "length": {
                                        "type": "number"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact",
                                      "offset",
                                      "length"
                                    ]
                                  },
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextQuoteSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "prefix": {
                                        "type": "string"
                                      },
                                      "suffix": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact"
                                    ]
                                  },
                                  {
                                    "type": "array",
                                    "items": {
                                      "anyOf": [
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextPositionSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "offset": {
                                              "type": "number"
                                            },
                                            "length": {
                                              "type": "number"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact",
                                            "offset",
                                            "length"
                                          ]
                                        },
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextQuoteSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "prefix": {
                                              "type": "string"
                                            },
                                            "suffix": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                ]
                              }
                            },
                            "required": [
                              "source",
                              "selector"
                            ]
                          },
                          "body": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "enum": [
                                  "TextualBody",
                                  "SpecificResource"
                                ]
                              },
                              "value": {
                                "type": "string"
                              },
                              "format": {
                                "type": "string"
                              },
                              "language": {
                                "type": "string"
                              },
                              "source": {
                                "type": [
                                  "string",
                                  "null"
                                ]
                              },
                              "entityTypes": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                },
                                "default": []
                              }
                            },
                            "required": [
                              "type"
                            ]
                          },
                          "creator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          },
                          "created": {
                            "type": "string"
                          },
                          "modified": {
                            "type": "string"
                          },
                          "generator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          }
                        },
                        "required": [
                          "id",
                          "motivation",
                          "target",
                          "body",
                          "creator",
                          "created"
                        ]
                      }
                    }
                  },
                  "required": [
                    "annotations"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/documents/{id}/events": {
      "get": {
        "summary": "Get Document Event History",
        "description": "Get full event history for a document with optional filtering",
        "tags": [
          "Documents",
          "Events"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          },
          {
            "schema": {
              "type": "string",
              "enum": [
                "document.created",
                "document.cloned",
                "document.archived",
                "document.unarchived",
                "highlight.added",
                "highlight.removed",
                "reference.created",
                "reference.resolved",
                "reference.deleted",
                "entitytag.added",
                "entitytag.removed"
              ]
            },
            "required": false,
            "name": "type",
            "in": "query"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": false,
            "name": "userId",
            "in": "query"
          },
          {
            "schema": {
              "type": "number",
              "minimum": 1,
              "maximum": 1000,
              "default": 100
            },
            "required": false,
            "name": "limit",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "Events retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "events": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "event": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string"
                              },
                              "timestamp": {
                                "type": "string"
                              },
                              "userId": {
                                "type": "string"
                              },
                              "documentId": {
                                "type": "string"
                              },
                              "payload": {}
                            },
                            "required": [
                              "id",
                              "type",
                              "timestamp",
                              "userId",
                              "documentId"
                            ]
                          },
                          "metadata": {
                            "type": "object",
                            "properties": {
                              "sequenceNumber": {
                                "type": "number"
                              },
                              "prevEventHash": {
                                "type": "string"
                              },
                              "checksum": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "sequenceNumber"
                            ]
                          }
                        },
                        "required": [
                          "event",
                          "metadata"
                        ]
                      }
                    },
                    "total": {
                      "type": "number"
                    },
                    "documentId": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "events",
                    "total",
                    "documentId"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/documents/{id}/events/stream": {
      "get": {
        "summary": "Subscribe to Document Events (SSE)",
        "description": "Open a Server-Sent Events stream to receive real-time document events",
        "tags": [
          "Documents",
          "Events",
          "Real-time"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "SSE stream opened successfully",
            "content": {
              "text/event-stream": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "event": {
                      "type": "string"
                    },
                    "data": {
                      "type": "string"
                    },
                    "id": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "event",
                    "data"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/annotations/{id}/create-document": {
      "post": {
        "summary": "Create Document from Annotation",
        "description": "Create a new document from an annotation and resolve the annotation to it",
        "tags": [
          "Selections"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 255
                  },
                  "entityTypes": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "content": {
                    "type": "string"
                  },
                  "format": {
                    "type": "string",
                    "default": "text/plain"
                  },
                  "metadata": {
                    "type": "object",
                    "additionalProperties": {}
                  }
                },
                "required": [
                  "name"
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Document created and annotation resolved",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "document": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "format": {
                          "type": "string"
                        },
                        "archived": {
                          "type": "boolean"
                        },
                        "entityTypes": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "locale": {
                          "type": "string"
                        },
                        "creationMethod": {
                          "type": "string",
                          "enum": [
                            "api",
                            "upload",
                            "ui",
                            "reference",
                            "clone",
                            "generated"
                          ]
                        },
                        "sourceAnnotationId": {
                          "type": "string"
                        },
                        "sourceDocumentId": {
                          "type": "string"
                        },
                        "creator": {
                          "type": "string"
                        },
                        "created": {
                          "type": "string"
                        },
                        "contentChecksum": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "name",
                        "format",
                        "archived",
                        "entityTypes",
                        "creationMethod",
                        "creator",
                        "created",
                        "contentChecksum"
                      ]
                    },
                    "annotation": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "motivation": {
                          "type": "string",
                          "enum": [
                            "assessing",
                            "bookmarking",
                            "classifying",
                            "commenting",
                            "describing",
                            "editing",
                            "highlighting",
                            "identifying",
                            "linking",
                            "moderating",
                            "questioning",
                            "replying",
                            "tagging"
                          ]
                        },
                        "target": {
                          "type": "object",
                          "properties": {
                            "source": {
                              "type": "string"
                            },
                            "selector": {
                              "anyOf": [
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "enum": [
                                        "TextPositionSelector"
                                      ]
                                    },
                                    "exact": {
                                      "type": "string"
                                    },
                                    "offset": {
                                      "type": "number"
                                    },
                                    "length": {
                                      "type": "number"
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "exact",
                                    "offset",
                                    "length"
                                  ]
                                },
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "enum": [
                                        "TextQuoteSelector"
                                      ]
                                    },
                                    "exact": {
                                      "type": "string"
                                    },
                                    "prefix": {
                                      "type": "string"
                                    },
                                    "suffix": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "exact"
                                  ]
                                },
                                {
                                  "type": "array",
                                  "items": {
                                    "anyOf": [
                                      {
                                        "type": "object",
                                        "properties": {
                                          "type": {
                                            "type": "string",
                                            "enum": [
                                              "TextPositionSelector"
                                            ]
                                          },
                                          "exact": {
                                            "type": "string"
                                          },
                                          "offset": {
                                            "type": "number"
                                          },
                                          "length": {
                                            "type": "number"
                                          }
                                        },
                                        "required": [
                                          "type",
                                          "exact",
                                          "offset",
                                          "length"
                                        ]
                                      },
                                      {
                                        "type": "object",
                                        "properties": {
                                          "type": {
                                            "type": "string",
                                            "enum": [
                                              "TextQuoteSelector"
                                            ]
                                          },
                                          "exact": {
                                            "type": "string"
                                          },
                                          "prefix": {
                                            "type": "string"
                                          },
                                          "suffix": {
                                            "type": "string"
                                          }
                                        },
                                        "required": [
                                          "type",
                                          "exact"
                                        ]
                                      }
                                    ]
                                  }
                                }
                              ]
                            }
                          },
                          "required": [
                            "source",
                            "selector"
                          ]
                        },
                        "body": {
                          "type": "object",
                          "properties": {
                            "type": {
                              "type": "string",
                              "enum": [
                                "TextualBody",
                                "SpecificResource"
                              ]
                            },
                            "value": {
                              "type": "string"
                            },
                            "format": {
                              "type": "string"
                            },
                            "language": {
                              "type": "string"
                            },
                            "source": {
                              "type": [
                                "string",
                                "null"
                              ]
                            },
                            "entityTypes": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              },
                              "default": []
                            }
                          },
                          "required": [
                            "type"
                          ]
                        },
                        "creator": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string"
                            },
                            "type": {
                              "type": "string",
                              "enum": [
                                "Person",
                                "Organization",
                                "Software"
                              ]
                            },
                            "name": {
                              "type": "string"
                            },
                            "nickname": {
                              "type": "string"
                            },
                            "email": {
                              "type": "string"
                            },
                            "email_sha1": {
                              "type": "string"
                            },
                            "homepage": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "id",
                            "type",
                            "name"
                          ]
                        },
                        "created": {
                          "type": "string"
                        },
                        "modified": {
                          "type": "string"
                        },
                        "generator": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string"
                            },
                            "type": {
                              "type": "string",
                              "enum": [
                                "Person",
                                "Organization",
                                "Software"
                              ]
                            },
                            "name": {
                              "type": "string"
                            },
                            "nickname": {
                              "type": "string"
                            },
                            "email": {
                              "type": "string"
                            },
                            "email_sha1": {
                              "type": "string"
                            },
                            "homepage": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "id",
                            "type",
                            "name"
                          ]
                        }
                      },
                      "required": [
                        "id",
                        "motivation",
                        "target",
                        "body",
                        "creator",
                        "created"
                      ]
                    }
                  },
                  "required": [
                    "document",
                    "annotation"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/annotations/{id}/generate-document": {
      "post": {
        "summary": "Generate Document from Annotation",
        "description": "Use AI to generate document content from an annotation",
        "tags": [
          "Selections"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 255,
                    "description": "Custom title for generated document"
                  },
                  "entityTypes": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "Entity types to apply to generated document"
                  },
                  "prompt": {
                    "type": "string",
                    "description": "Custom prompt for content generation"
                  },
                  "locale": {
                    "type": "string",
                    "description": "Language locale for generated content (e.g., \"es\", \"fr\", \"ja\")"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Document generated and annotation resolved",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "document": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "format": {
                          "type": "string"
                        },
                        "archived": {
                          "type": "boolean"
                        },
                        "entityTypes": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "locale": {
                          "type": "string"
                        },
                        "creationMethod": {
                          "type": "string",
                          "enum": [
                            "api",
                            "upload",
                            "ui",
                            "reference",
                            "clone",
                            "generated"
                          ]
                        },
                        "sourceAnnotationId": {
                          "type": "string"
                        },
                        "sourceDocumentId": {
                          "type": "string"
                        },
                        "creator": {
                          "type": "string"
                        },
                        "created": {
                          "type": "string"
                        },
                        "contentChecksum": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "name",
                        "format",
                        "archived",
                        "entityTypes",
                        "creationMethod",
                        "creator",
                        "created",
                        "contentChecksum"
                      ]
                    },
                    "annotation": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "motivation": {
                          "type": "string",
                          "enum": [
                            "assessing",
                            "bookmarking",
                            "classifying",
                            "commenting",
                            "describing",
                            "editing",
                            "highlighting",
                            "identifying",
                            "linking",
                            "moderating",
                            "questioning",
                            "replying",
                            "tagging"
                          ]
                        },
                        "target": {
                          "type": "object",
                          "properties": {
                            "source": {
                              "type": "string"
                            },
                            "selector": {
                              "anyOf": [
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "enum": [
                                        "TextPositionSelector"
                                      ]
                                    },
                                    "exact": {
                                      "type": "string"
                                    },
                                    "offset": {
                                      "type": "number"
                                    },
                                    "length": {
                                      "type": "number"
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "exact",
                                    "offset",
                                    "length"
                                  ]
                                },
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "enum": [
                                        "TextQuoteSelector"
                                      ]
                                    },
                                    "exact": {
                                      "type": "string"
                                    },
                                    "prefix": {
                                      "type": "string"
                                    },
                                    "suffix": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "exact"
                                  ]
                                },
                                {
                                  "type": "array",
                                  "items": {
                                    "anyOf": [
                                      {
                                        "type": "object",
                                        "properties": {
                                          "type": {
                                            "type": "string",
                                            "enum": [
                                              "TextPositionSelector"
                                            ]
                                          },
                                          "exact": {
                                            "type": "string"
                                          },
                                          "offset": {
                                            "type": "number"
                                          },
                                          "length": {
                                            "type": "number"
                                          }
                                        },
                                        "required": [
                                          "type",
                                          "exact",
                                          "offset",
                                          "length"
                                        ]
                                      },
                                      {
                                        "type": "object",
                                        "properties": {
                                          "type": {
                                            "type": "string",
                                            "enum": [
                                              "TextQuoteSelector"
                                            ]
                                          },
                                          "exact": {
                                            "type": "string"
                                          },
                                          "prefix": {
                                            "type": "string"
                                          },
                                          "suffix": {
                                            "type": "string"
                                          }
                                        },
                                        "required": [
                                          "type",
                                          "exact"
                                        ]
                                      }
                                    ]
                                  }
                                }
                              ]
                            }
                          },
                          "required": [
                            "source",
                            "selector"
                          ]
                        },
                        "body": {
                          "type": "object",
                          "properties": {
                            "type": {
                              "type": "string",
                              "enum": [
                                "TextualBody",
                                "SpecificResource"
                              ]
                            },
                            "value": {
                              "type": "string"
                            },
                            "format": {
                              "type": "string"
                            },
                            "language": {
                              "type": "string"
                            },
                            "source": {
                              "type": [
                                "string",
                                "null"
                              ]
                            },
                            "entityTypes": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              },
                              "default": []
                            }
                          },
                          "required": [
                            "type"
                          ]
                        },
                        "creator": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string"
                            },
                            "type": {
                              "type": "string",
                              "enum": [
                                "Person",
                                "Organization",
                                "Software"
                              ]
                            },
                            "name": {
                              "type": "string"
                            },
                            "nickname": {
                              "type": "string"
                            },
                            "email": {
                              "type": "string"
                            },
                            "email_sha1": {
                              "type": "string"
                            },
                            "homepage": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "id",
                            "type",
                            "name"
                          ]
                        },
                        "created": {
                          "type": "string"
                        },
                        "modified": {
                          "type": "string"
                        },
                        "generator": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string"
                            },
                            "type": {
                              "type": "string",
                              "enum": [
                                "Person",
                                "Organization",
                                "Software"
                              ]
                            },
                            "name": {
                              "type": "string"
                            },
                            "nickname": {
                              "type": "string"
                            },
                            "email": {
                              "type": "string"
                            },
                            "email_sha1": {
                              "type": "string"
                            },
                            "homepage": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "id",
                            "type",
                            "name"
                          ]
                        }
                      },
                      "required": [
                        "id",
                        "motivation",
                        "target",
                        "body",
                        "creator",
                        "created"
                      ]
                    },
                    "generated": {
                      "type": "boolean"
                    }
                  },
                  "required": [
                    "document",
                    "annotation",
                    "generated"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/annotations/{id}/context": {
      "get": {
        "summary": "Get Annotation Context",
        "description": "Get the context around an annotation",
        "tags": [
          "Selections"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          },
          {
            "schema": {
              "type": [
                "integer",
                "null"
              ],
              "minimum": 0,
              "maximum": 5000,
              "default": 100
            },
            "required": false,
            "name": "contextBefore",
            "in": "query"
          },
          {
            "schema": {
              "type": [
                "integer",
                "null"
              ],
              "minimum": 0,
              "maximum": 5000,
              "default": 100
            },
            "required": false,
            "name": "contextAfter",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "Annotation context",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "annotation": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "documentId": {
                          "type": "string"
                        },
                        "selector": {
                          "type": "object",
                          "properties": {
                            "exact": {
                              "type": "string"
                            },
                            "offset": {
                              "type": "number"
                            },
                            "length": {
                              "type": "number"
                            }
                          },
                          "required": [
                            "exact",
                            "offset",
                            "length"
                          ]
                        },
                        "referencedDocumentId": {
                          "type": [
                            "string",
                            "null"
                          ]
                        },
                        "entityTypes": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "createdBy": {
                          "type": "string"
                        },
                        "createdAt": {
                          "type": "string"
                        },
                        "updatedAt": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "documentId",
                        "selector",
                        "referencedDocumentId",
                        "entityTypes",
                        "createdBy",
                        "createdAt",
                        "updatedAt"
                      ]
                    },
                    "context": {
                      "type": "object",
                      "properties": {
                        "before": {
                          "type": "string"
                        },
                        "selected": {
                          "type": "string"
                        },
                        "after": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "selected"
                      ]
                    },
                    "document": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "format": {
                          "type": "string"
                        },
                        "archived": {
                          "type": "boolean"
                        },
                        "entityTypes": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "locale": {
                          "type": "string"
                        },
                        "creationMethod": {
                          "type": "string",
                          "enum": [
                            "api",
                            "upload",
                            "ui",
                            "reference",
                            "clone",
                            "generated"
                          ]
                        },
                        "sourceAnnotationId": {
                          "type": "string"
                        },
                        "sourceDocumentId": {
                          "type": "string"
                        },
                        "creator": {
                          "type": "string"
                        },
                        "created": {
                          "type": "string"
                        },
                        "contentChecksum": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "name",
                        "format",
                        "archived",
                        "entityTypes",
                        "creationMethod",
                        "creator",
                        "created",
                        "contentChecksum"
                      ]
                    }
                  },
                  "required": [
                    "annotation",
                    "context",
                    "document"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/annotations/{id}/summary": {
      "get": {
        "summary": "Get Contextual Summary",
        "description": "Get an AI-generated summary of the annotation in context",
        "tags": [
          "Selections"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Contextual summary",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "summary": {
                      "type": "string"
                    },
                    "relevantFields": {
                      "type": "object",
                      "additionalProperties": {}
                    },
                    "context": {
                      "type": "object",
                      "properties": {
                        "before": {
                          "type": "string"
                        },
                        "selected": {
                          "type": "string"
                        },
                        "after": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "selected"
                      ]
                    }
                  },
                  "required": [
                    "summary",
                    "relevantFields",
                    "context"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/annotations/{id}/generate-document-stream": {
      "post": {
        "summary": "Generate Document from Reference (SSE)",
        "description": "Stream real-time document generation progress via Server-Sent Events",
        "tags": [
          "Selections",
          "Documents",
          "Real-time",
          "AI"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "description": "Reference/annotation ID"
            },
            "required": true,
            "description": "Reference/annotation ID",
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "documentId": {
                    "type": "string",
                    "description": "Document ID containing the reference"
                  },
                  "title": {
                    "type": "string",
                    "description": "Custom title for generated document"
                  },
                  "prompt": {
                    "type": "string",
                    "description": "Custom prompt for content generation"
                  },
                  "locale": {
                    "type": "string",
                    "description": "Language locale for generated content (e.g., \"es\", \"fr\", \"ja\")"
                  }
                },
                "required": [
                  "documentId"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "SSE stream opened successfully",
            "content": {
              "text/event-stream": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "event": {
                      "type": "string"
                    },
                    "data": {
                      "type": "string"
                    },
                    "id": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "event",
                    "data"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Authentication required"
          },
          "404": {
            "description": "Reference not found"
          }
        }
      }
    },
    "/api/annotations": {
      "post": {
        "summary": "Create Annotation",
        "description": "Create a new annotation/reference in a document",
        "tags": [
          "Annotations"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "motivation": {
                    "type": "string",
                    "enum": [
                      "assessing",
                      "bookmarking",
                      "classifying",
                      "commenting",
                      "describing",
                      "editing",
                      "highlighting",
                      "identifying",
                      "linking",
                      "moderating",
                      "questioning",
                      "replying",
                      "tagging"
                    ]
                  },
                  "target": {
                    "type": "object",
                    "properties": {
                      "source": {
                        "type": "string"
                      },
                      "selector": {
                        "anyOf": [
                          {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "enum": [
                                  "TextPositionSelector"
                                ]
                              },
                              "exact": {
                                "type": "string"
                              },
                              "offset": {
                                "type": "number"
                              },
                              "length": {
                                "type": "number"
                              }
                            },
                            "required": [
                              "type",
                              "exact",
                              "offset",
                              "length"
                            ]
                          },
                          {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "enum": [
                                  "TextQuoteSelector"
                                ]
                              },
                              "exact": {
                                "type": "string"
                              },
                              "prefix": {
                                "type": "string"
                              },
                              "suffix": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "type",
                              "exact"
                            ]
                          },
                          {
                            "type": "array",
                            "items": {
                              "anyOf": [
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "enum": [
                                        "TextPositionSelector"
                                      ]
                                    },
                                    "exact": {
                                      "type": "string"
                                    },
                                    "offset": {
                                      "type": "number"
                                    },
                                    "length": {
                                      "type": "number"
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "exact",
                                    "offset",
                                    "length"
                                  ]
                                },
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "enum": [
                                        "TextQuoteSelector"
                                      ]
                                    },
                                    "exact": {
                                      "type": "string"
                                    },
                                    "prefix": {
                                      "type": "string"
                                    },
                                    "suffix": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "exact"
                                  ]
                                }
                              ]
                            }
                          }
                        ]
                      }
                    },
                    "required": [
                      "source",
                      "selector"
                    ]
                  },
                  "body": {
                    "type": "object",
                    "properties": {
                      "type": {
                        "type": "string",
                        "enum": [
                          "TextualBody",
                          "SpecificResource"
                        ]
                      },
                      "value": {
                        "type": "string"
                      },
                      "source": {
                        "type": [
                          "string",
                          "null"
                        ]
                      },
                      "entityTypes": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      }
                    },
                    "required": [
                      "type"
                    ]
                  }
                },
                "required": [
                  "target",
                  "body"
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Annotation created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "annotation": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "motivation": {
                          "type": "string",
                          "enum": [
                            "assessing",
                            "bookmarking",
                            "classifying",
                            "commenting",
                            "describing",
                            "editing",
                            "highlighting",
                            "identifying",
                            "linking",
                            "moderating",
                            "questioning",
                            "replying",
                            "tagging"
                          ]
                        },
                        "target": {
                          "type": "object",
                          "properties": {
                            "source": {
                              "type": "string"
                            },
                            "selector": {
                              "anyOf": [
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "enum": [
                                        "TextPositionSelector"
                                      ]
                                    },
                                    "exact": {
                                      "type": "string"
                                    },
                                    "offset": {
                                      "type": "number"
                                    },
                                    "length": {
                                      "type": "number"
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "exact",
                                    "offset",
                                    "length"
                                  ]
                                },
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "enum": [
                                        "TextQuoteSelector"
                                      ]
                                    },
                                    "exact": {
                                      "type": "string"
                                    },
                                    "prefix": {
                                      "type": "string"
                                    },
                                    "suffix": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "exact"
                                  ]
                                },
                                {
                                  "type": "array",
                                  "items": {
                                    "anyOf": [
                                      {
                                        "type": "object",
                                        "properties": {
                                          "type": {
                                            "type": "string",
                                            "enum": [
                                              "TextPositionSelector"
                                            ]
                                          },
                                          "exact": {
                                            "type": "string"
                                          },
                                          "offset": {
                                            "type": "number"
                                          },
                                          "length": {
                                            "type": "number"
                                          }
                                        },
                                        "required": [
                                          "type",
                                          "exact",
                                          "offset",
                                          "length"
                                        ]
                                      },
                                      {
                                        "type": "object",
                                        "properties": {
                                          "type": {
                                            "type": "string",
                                            "enum": [
                                              "TextQuoteSelector"
                                            ]
                                          },
                                          "exact": {
                                            "type": "string"
                                          },
                                          "prefix": {
                                            "type": "string"
                                          },
                                          "suffix": {
                                            "type": "string"
                                          }
                                        },
                                        "required": [
                                          "type",
                                          "exact"
                                        ]
                                      }
                                    ]
                                  }
                                }
                              ]
                            }
                          },
                          "required": [
                            "source",
                            "selector"
                          ]
                        },
                        "body": {
                          "type": "object",
                          "properties": {
                            "type": {
                              "type": "string",
                              "enum": [
                                "TextualBody",
                                "SpecificResource"
                              ]
                            },
                            "value": {
                              "type": "string"
                            },
                            "format": {
                              "type": "string"
                            },
                            "language": {
                              "type": "string"
                            },
                            "source": {
                              "type": [
                                "string",
                                "null"
                              ]
                            },
                            "entityTypes": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              },
                              "default": []
                            }
                          },
                          "required": [
                            "type"
                          ]
                        },
                        "creator": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string"
                            },
                            "type": {
                              "type": "string",
                              "enum": [
                                "Person",
                                "Organization",
                                "Software"
                              ]
                            },
                            "name": {
                              "type": "string"
                            },
                            "nickname": {
                              "type": "string"
                            },
                            "email": {
                              "type": "string"
                            },
                            "email_sha1": {
                              "type": "string"
                            },
                            "homepage": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "id",
                            "type",
                            "name"
                          ]
                        },
                        "created": {
                          "type": "string"
                        },
                        "modified": {
                          "type": "string"
                        },
                        "generator": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string"
                            },
                            "type": {
                              "type": "string",
                              "enum": [
                                "Person",
                                "Organization",
                                "Software"
                              ]
                            },
                            "name": {
                              "type": "string"
                            },
                            "nickname": {
                              "type": "string"
                            },
                            "email": {
                              "type": "string"
                            },
                            "email_sha1": {
                              "type": "string"
                            },
                            "homepage": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "id",
                            "type",
                            "name"
                          ]
                        }
                      },
                      "required": [
                        "id",
                        "motivation",
                        "target",
                        "body",
                        "creator",
                        "created"
                      ]
                    }
                  },
                  "required": [
                    "annotation"
                  ]
                }
              }
            }
          }
        }
      },
      "get": {
        "summary": "List Annotations",
        "description": "List all annotations for a document (requires documentId for O(1) Layer 3 lookup)",
        "tags": [
          "Annotations"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "description": "Document ID to list annotations for"
            },
            "required": true,
            "description": "Document ID to list annotations for",
            "name": "documentId",
            "in": "query"
          },
          {
            "schema": {
              "type": [
                "number",
                "null"
              ],
              "default": 0
            },
            "required": false,
            "name": "offset",
            "in": "query"
          },
          {
            "schema": {
              "type": [
                "number",
                "null"
              ],
              "default": 50
            },
            "required": false,
            "name": "limit",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "Annotations listed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "annotations": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "motivation": {
                            "type": "string",
                            "enum": [
                              "assessing",
                              "bookmarking",
                              "classifying",
                              "commenting",
                              "describing",
                              "editing",
                              "highlighting",
                              "identifying",
                              "linking",
                              "moderating",
                              "questioning",
                              "replying",
                              "tagging"
                            ]
                          },
                          "target": {
                            "type": "object",
                            "properties": {
                              "source": {
                                "type": "string"
                              },
                              "selector": {
                                "anyOf": [
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextPositionSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "offset": {
                                        "type": "number"
                                      },
                                      "length": {
                                        "type": "number"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact",
                                      "offset",
                                      "length"
                                    ]
                                  },
                                  {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string",
                                        "enum": [
                                          "TextQuoteSelector"
                                        ]
                                      },
                                      "exact": {
                                        "type": "string"
                                      },
                                      "prefix": {
                                        "type": "string"
                                      },
                                      "suffix": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "type",
                                      "exact"
                                    ]
                                  },
                                  {
                                    "type": "array",
                                    "items": {
                                      "anyOf": [
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextPositionSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "offset": {
                                              "type": "number"
                                            },
                                            "length": {
                                              "type": "number"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact",
                                            "offset",
                                            "length"
                                          ]
                                        },
                                        {
                                          "type": "object",
                                          "properties": {
                                            "type": {
                                              "type": "string",
                                              "enum": [
                                                "TextQuoteSelector"
                                              ]
                                            },
                                            "exact": {
                                              "type": "string"
                                            },
                                            "prefix": {
                                              "type": "string"
                                            },
                                            "suffix": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "type",
                                            "exact"
                                          ]
                                        }
                                      ]
                                    }
                                  }
                                ]
                              }
                            },
                            "required": [
                              "source",
                              "selector"
                            ]
                          },
                          "body": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "enum": [
                                  "TextualBody",
                                  "SpecificResource"
                                ]
                              },
                              "value": {
                                "type": "string"
                              },
                              "format": {
                                "type": "string"
                              },
                              "language": {
                                "type": "string"
                              },
                              "source": {
                                "type": [
                                  "string",
                                  "null"
                                ]
                              },
                              "entityTypes": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                },
                                "default": []
                              }
                            },
                            "required": [
                              "type"
                            ]
                          },
                          "creator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          },
                          "created": {
                            "type": "string"
                          },
                          "modified": {
                            "type": "string"
                          },
                          "generator": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "Person",
                                  "Organization",
                                  "Software"
                                ]
                              },
                              "name": {
                                "type": "string"
                              },
                              "nickname": {
                                "type": "string"
                              },
                              "email": {
                                "type": "string"
                              },
                              "email_sha1": {
                                "type": "string"
                              },
                              "homepage": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id",
                              "type",
                              "name"
                            ]
                          }
                        },
                        "required": [
                          "id",
                          "motivation",
                          "target",
                          "body",
                          "creator",
                          "created"
                        ]
                      }
                    },
                    "total": {
                      "type": "number"
                    },
                    "offset": {
                      "type": "number"
                    },
                    "limit": {
                      "type": "number"
                    }
                  },
                  "required": [
                    "annotations",
                    "total",
                    "offset",
                    "limit"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/annotations/{id}/resolve": {
      "put": {
        "summary": "Resolve Annotation",
        "description": "Resolve a reference annotation to a target document",
        "tags": [
          "Annotations"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "documentId": {
                    "type": "string",
                    "description": "Target document ID to resolve reference to"
                  }
                },
                "required": [
                  "documentId"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Annotation resolved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "annotation": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "motivation": {
                          "type": "string",
                          "enum": [
                            "assessing",
                            "bookmarking",
                            "classifying",
                            "commenting",
                            "describing",
                            "editing",
                            "highlighting",
                            "identifying",
                            "linking",
                            "moderating",
                            "questioning",
                            "replying",
                            "tagging"
                          ]
                        },
                        "target": {
                          "type": "object",
                          "properties": {
                            "source": {
                              "type": "string"
                            },
                            "selector": {
                              "anyOf": [
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "enum": [
                                        "TextPositionSelector"
                                      ]
                                    },
                                    "exact": {
                                      "type": "string"
                                    },
                                    "offset": {
                                      "type": "number"
                                    },
                                    "length": {
                                      "type": "number"
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "exact",
                                    "offset",
                                    "length"
                                  ]
                                },
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "enum": [
                                        "TextQuoteSelector"
                                      ]
                                    },
                                    "exact": {
                                      "type": "string"
                                    },
                                    "prefix": {
                                      "type": "string"
                                    },
                                    "suffix": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "exact"
                                  ]
                                },
                                {
                                  "type": "array",
                                  "items": {
                                    "anyOf": [
                                      {
                                        "type": "object",
                                        "properties": {
                                          "type": {
                                            "type": "string",
                                            "enum": [
                                              "TextPositionSelector"
                                            ]
                                          },
                                          "exact": {
                                            "type": "string"
                                          },
                                          "offset": {
                                            "type": "number"
                                          },
                                          "length": {
                                            "type": "number"
                                          }
                                        },
                                        "required": [
                                          "type",
                                          "exact",
                                          "offset",
                                          "length"
                                        ]
                                      },
                                      {
                                        "type": "object",
                                        "properties": {
                                          "type": {
                                            "type": "string",
                                            "enum": [
                                              "TextQuoteSelector"
                                            ]
                                          },
                                          "exact": {
                                            "type": "string"
                                          },
                                          "prefix": {
                                            "type": "string"
                                          },
                                          "suffix": {
                                            "type": "string"
                                          }
                                        },
                                        "required": [
                                          "type",
                                          "exact"
                                        ]
                                      }
                                    ]
                                  }
                                }
                              ]
                            }
                          },
                          "required": [
                            "source",
                            "selector"
                          ]
                        },
                        "body": {
                          "type": "object",
                          "properties": {
                            "type": {
                              "type": "string",
                              "enum": [
                                "TextualBody",
                                "SpecificResource"
                              ]
                            },
                            "value": {
                              "type": "string"
                            },
                            "format": {
                              "type": "string"
                            },
                            "language": {
                              "type": "string"
                            },
                            "source": {
                              "type": [
                                "string",
                                "null"
                              ]
                            },
                            "entityTypes": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              },
                              "default": []
                            }
                          },
                          "required": [
                            "type"
                          ]
                        },
                        "creator": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string"
                            },
                            "type": {
                              "type": "string",
                              "enum": [
                                "Person",
                                "Organization",
                                "Software"
                              ]
                            },
                            "name": {
                              "type": "string"
                            },
                            "nickname": {
                              "type": "string"
                            },
                            "email": {
                              "type": "string"
                            },
                            "email_sha1": {
                              "type": "string"
                            },
                            "homepage": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "id",
                            "type",
                            "name"
                          ]
                        },
                        "created": {
                          "type": "string"
                        },
                        "modified": {
                          "type": "string"
                        },
                        "generator": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string"
                            },
                            "type": {
                              "type": "string",
                              "enum": [
                                "Person",
                                "Organization",
                                "Software"
                              ]
                            },
                            "name": {
                              "type": "string"
                            },
                            "nickname": {
                              "type": "string"
                            },
                            "email": {
                              "type": "string"
                            },
                            "email_sha1": {
                              "type": "string"
                            },
                            "homepage": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "id",
                            "type",
                            "name"
                          ]
                        }
                      },
                      "required": [
                        "id",
                        "motivation",
                        "target",
                        "body",
                        "creator",
                        "created"
                      ]
                    },
                    "targetDocument": {
                      "type": [
                        "object",
                        "null"
                      ],
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "format": {
                          "type": "string"
                        },
                        "archived": {
                          "type": "boolean"
                        },
                        "entityTypes": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "locale": {
                          "type": "string"
                        },
                        "creationMethod": {
                          "type": "string",
                          "enum": [
                            "api",
                            "upload",
                            "ui",
                            "reference",
                            "clone",
                            "generated"
                          ]
                        },
                        "sourceAnnotationId": {
                          "type": "string"
                        },
                        "sourceDocumentId": {
                          "type": "string"
                        },
                        "creator": {
                          "type": "string"
                        },
                        "created": {
                          "type": "string"
                        },
                        "contentChecksum": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "name",
                        "format",
                        "archived",
                        "entityTypes",
                        "creationMethod",
                        "creator",
                        "created",
                        "contentChecksum"
                      ]
                    }
                  },
                  "required": [
                    "annotation",
                    "targetDocument"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/annotations/{id}": {
      "get": {
        "summary": "Get Annotation",
        "description": "Get an annotation by ID (requires documentId query param for O(1) Layer 3 lookup)",
        "tags": [
          "Annotations"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          },
          {
            "schema": {
              "type": "string",
              "description": "Document ID containing the annotation"
            },
            "required": true,
            "description": "Document ID containing the annotation",
            "name": "documentId",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "Annotation retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "annotation": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "motivation": {
                          "type": "string",
                          "enum": [
                            "assessing",
                            "bookmarking",
                            "classifying",
                            "commenting",
                            "describing",
                            "editing",
                            "highlighting",
                            "identifying",
                            "linking",
                            "moderating",
                            "questioning",
                            "replying",
                            "tagging"
                          ]
                        },
                        "target": {
                          "type": "object",
                          "properties": {
                            "source": {
                              "type": "string"
                            },
                            "selector": {
                              "anyOf": [
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "enum": [
                                        "TextPositionSelector"
                                      ]
                                    },
                                    "exact": {
                                      "type": "string"
                                    },
                                    "offset": {
                                      "type": "number"
                                    },
                                    "length": {
                                      "type": "number"
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "exact",
                                    "offset",
                                    "length"
                                  ]
                                },
                                {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "enum": [
                                        "TextQuoteSelector"
                                      ]
                                    },
                                    "exact": {
                                      "type": "string"
                                    },
                                    "prefix": {
                                      "type": "string"
                                    },
                                    "suffix": {
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "type",
                                    "exact"
                                  ]
                                },
                                {
                                  "type": "array",
                                  "items": {
                                    "anyOf": [
                                      {
                                        "type": "object",
                                        "properties": {
                                          "type": {
                                            "type": "string",
                                            "enum": [
                                              "TextPositionSelector"
                                            ]
                                          },
                                          "exact": {
                                            "type": "string"
                                          },
                                          "offset": {
                                            "type": "number"
                                          },
                                          "length": {
                                            "type": "number"
                                          }
                                        },
                                        "required": [
                                          "type",
                                          "exact",
                                          "offset",
                                          "length"
                                        ]
                                      },
                                      {
                                        "type": "object",
                                        "properties": {
                                          "type": {
                                            "type": "string",
                                            "enum": [
                                              "TextQuoteSelector"
                                            ]
                                          },
                                          "exact": {
                                            "type": "string"
                                          },
                                          "prefix": {
                                            "type": "string"
                                          },
                                          "suffix": {
                                            "type": "string"
                                          }
                                        },
                                        "required": [
                                          "type",
                                          "exact"
                                        ]
                                      }
                                    ]
                                  }
                                }
                              ]
                            }
                          },
                          "required": [
                            "source",
                            "selector"
                          ]
                        },
                        "body": {
                          "type": "object",
                          "properties": {
                            "type": {
                              "type": "string",
                              "enum": [
                                "TextualBody",
                                "SpecificResource"
                              ]
                            },
                            "value": {
                              "type": "string"
                            },
                            "format": {
                              "type": "string"
                            },
                            "language": {
                              "type": "string"
                            },
                            "source": {
                              "type": [
                                "string",
                                "null"
                              ]
                            },
                            "entityTypes": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              },
                              "default": []
                            }
                          },
                          "required": [
                            "type"
                          ]
                        },
                        "creator": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string"
                            },
                            "type": {
                              "type": "string",
                              "enum": [
                                "Person",
                                "Organization",
                                "Software"
                              ]
                            },
                            "name": {
                              "type": "string"
                            },
                            "nickname": {
                              "type": "string"
                            },
                            "email": {
                              "type": "string"
                            },
                            "email_sha1": {
                              "type": "string"
                            },
                            "homepage": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "id",
                            "type",
                            "name"
                          ]
                        },
                        "created": {
                          "type": "string"
                        },
                        "modified": {
                          "type": "string"
                        },
                        "generator": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string"
                            },
                            "type": {
                              "type": "string",
                              "enum": [
                                "Person",
                                "Organization",
                                "Software"
                              ]
                            },
                            "name": {
                              "type": "string"
                            },
                            "nickname": {
                              "type": "string"
                            },
                            "email": {
                              "type": "string"
                            },
                            "email_sha1": {
                              "type": "string"
                            },
                            "homepage": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "id",
                            "type",
                            "name"
                          ]
                        }
                      },
                      "required": [
                        "id",
                        "motivation",
                        "target",
                        "body",
                        "creator",
                        "created"
                      ]
                    },
                    "document": {
                      "type": [
                        "object",
                        "null"
                      ],
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "format": {
                          "type": "string"
                        },
                        "archived": {
                          "type": "boolean"
                        },
                        "entityTypes": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "locale": {
                          "type": "string"
                        },
                        "creationMethod": {
                          "type": "string",
                          "enum": [
                            "api",
                            "upload",
                            "ui",
                            "reference",
                            "clone",
                            "generated"
                          ]
                        },
                        "sourceAnnotationId": {
                          "type": "string"
                        },
                        "sourceDocumentId": {
                          "type": "string"
                        },
                        "creator": {
                          "type": "string"
                        },
                        "created": {
                          "type": "string"
                        },
                        "contentChecksum": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "name",
                        "format",
                        "archived",
                        "entityTypes",
                        "creationMethod",
                        "creator",
                        "created",
                        "contentChecksum"
                      ]
                    },
                    "resolvedDocument": {
                      "type": [
                        "object",
                        "null"
                      ],
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        },
                        "format": {
                          "type": "string"
                        },
                        "archived": {
                          "type": "boolean"
                        },
                        "entityTypes": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "locale": {
                          "type": "string"
                        },
                        "creationMethod": {
                          "type": "string",
                          "enum": [
                            "api",
                            "upload",
                            "ui",
                            "reference",
                            "clone",
                            "generated"
                          ]
                        },
                        "sourceAnnotationId": {
                          "type": "string"
                        },
                        "sourceDocumentId": {
                          "type": "string"
                        },
                        "creator": {
                          "type": "string"
                        },
                        "created": {
                          "type": "string"
                        },
                        "contentChecksum": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id",
                        "name",
                        "format",
                        "archived",
                        "entityTypes",
                        "creationMethod",
                        "creator",
                        "created",
                        "contentChecksum"
                      ]
                    }
                  },
                  "required": [
                    "annotation",
                    "document",
                    "resolvedDocument"
                  ]
                }
              }
            }
          }
        }
      },
      "delete": {
        "summary": "Delete Annotation",
        "description": "Delete an annotation (requires documentId in body for O(1) Layer 3 lookup)",
        "tags": [
          "Annotations"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "documentId": {
                    "type": "string",
                    "description": "Document ID containing the annotation (required for O(1) Layer 3 lookup)"
                  }
                },
                "required": [
                  "documentId"
                ]
              }
            }
          }
        },
        "responses": {
          "204": {
            "description": "Annotation deleted successfully"
          },
          "404": {
            "description": "Annotation not found"
          }
        }
      }
    },
    "/api/documents/{documentId}/annotations/{annotationId}/history": {
      "get": {
        "summary": "Get Annotation History",
        "description": "Get full event history for a specific annotation (highlight or reference)",
        "tags": [
          "Selections",
          "Events"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "documentId",
            "in": "path"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": true,
            "name": "annotationId",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Annotation history retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "events": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "type": {
                            "type": "string"
                          },
                          "timestamp": {
                            "type": "string"
                          },
                          "userId": {
                            "type": "string"
                          },
                          "documentId": {
                            "type": "string"
                          },
                          "payload": {
                            "anyOf": [
                              {
                                "type": "object",
                                "properties": {
                                  "name": {
                                    "type": "string"
                                  },
                                  "format": {
                                    "type": "string"
                                  },
                                  "contentHash": {
                                    "type": "string"
                                  },
                                  "creationMethod": {
                                    "type": "string",
                                    "enum": [
                                      "api",
                                      "upload",
                                      "ui",
                                      "reference",
                                      "clone",
                                      "generated"
                                    ]
                                  },
                                  "entityTypes": {
                                    "type": "array",
                                    "items": {
                                      "type": "string"
                                    }
                                  },
                                  "metadata": {
                                    "type": "object",
                                    "additionalProperties": {}
                                  }
                                },
                                "required": [
                                  "name",
                                  "format",
                                  "contentHash",
                                  "creationMethod"
                                ]
                              },
                              {
                                "type": "object",
                                "properties": {
                                  "name": {
                                    "type": "string"
                                  },
                                  "format": {
                                    "type": "string"
                                  },
                                  "contentHash": {
                                    "type": "string"
                                  },
                                  "parentDocumentId": {
                                    "type": "string"
                                  },
                                  "creationMethod": {
                                    "type": "string",
                                    "enum": [
                                      "api",
                                      "upload",
                                      "ui",
                                      "reference",
                                      "clone",
                                      "generated"
                                    ]
                                  },
                                  "entityTypes": {
                                    "type": "array",
                                    "items": {
                                      "type": "string"
                                    }
                                  },
                                  "metadata": {
                                    "type": "object",
                                    "additionalProperties": {}
                                  }
                                },
                                "required": [
                                  "name",
                                  "format",
                                  "contentHash",
                                  "parentDocumentId",
                                  "creationMethod"
                                ]
                              },
                              {
                                "type": "object",
                                "properties": {
                                  "reason": {
                                    "type": "string"
                                  }
                                }
                              },
                              {
                                "type": "object",
                                "properties": {}
                              },
                              {
                                "type": "object",
                                "properties": {
                                  "highlightId": {
                                    "type": "string"
                                  },
                                  "exact": {
                                    "type": "string"
                                  },
                                  "position": {
                                    "type": "object",
                                    "properties": {
                                      "offset": {
                                        "type": "number"
                                      },
                                      "length": {
                                        "type": "number"
                                      }
                                    },
                                    "required": [
                                      "offset",
                                      "length"
                                    ]
                                  }
                                },
                                "required": [
                                  "highlightId",
                                  "exact",
                                  "position"
                                ]
                              },
                              {
                                "type": "object",
                                "properties": {
                                  "highlightId": {
                                    "type": "string"
                                  }
                                },
                                "required": [
                                  "highlightId"
                                ]
                              },
                              {
                                "type": "object",
                                "properties": {
                                  "referenceId": {
                                    "type": "string"
                                  },
                                  "exact": {
                                    "type": "string"
                                  },
                                  "position": {
                                    "type": "object",
                                    "properties": {
                                      "offset": {
                                        "type": "number"
                                      },
                                      "length": {
                                        "type": "number"
                                      }
                                    },
                                    "required": [
                                      "offset",
                                      "length"
                                    ]
                                  },
                                  "entityTypes": {
                                    "type": "array",
                                    "items": {
                                      "type": "string"
                                    }
                                  },
                                  "targetDocumentId": {
                                    "type": "string"
                                  }
                                },
                                "required": [
                                  "referenceId",
                                  "exact",
                                  "position"
                                ]
                              },
                              {
                                "type": "object",
                                "properties": {
                                  "referenceId": {
                                    "type": "string"
                                  },
                                  "targetDocumentId": {
                                    "type": "string"
                                  }
                                },
                                "required": [
                                  "referenceId",
                                  "targetDocumentId"
                                ]
                              },
                              {
                                "type": "object",
                                "properties": {
                                  "referenceId": {
                                    "type": "string"
                                  }
                                },
                                "required": [
                                  "referenceId"
                                ]
                              },
                              {
                                "type": "object",
                                "properties": {
                                  "entityType": {
                                    "type": "string"
                                  }
                                },
                                "required": [
                                  "entityType"
                                ]
                              },
                              {
                                "type": "object",
                                "properties": {
                                  "entityType": {
                                    "type": "string"
                                  }
                                },
                                "required": [
                                  "entityType"
                                ]
                              }
                            ]
                          },
                          "metadata": {
                            "type": "object",
                            "properties": {
                              "sequenceNumber": {
                                "type": "number"
                              },
                              "prevEventHash": {
                                "type": "string"
                              },
                              "checksum": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "sequenceNumber"
                            ]
                          }
                        },
                        "required": [
                          "id",
                          "type",
                          "timestamp",
                          "userId",
                          "documentId",
                          "payload",
                          "metadata"
                        ]
                      }
                    },
                    "total": {
                      "type": "number"
                    },
                    "annotationId": {
                      "type": "string"
                    },
                    "documentId": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "events",
                    "total",
                    "annotationId",
                    "documentId"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Annotation not found"
          }
        }
      }
    },
    "/api/entity-types": {
      "get": {
        "summary": "Get Entity Types",
        "description": "Get list of available entity types for references",
        "tags": [
          "Selections"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Entity types retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "entityTypes": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  },
                  "required": [
                    "entityTypes"
                  ]
                }
              }
            }
          }
        }
      },
      "post": {
        "summary": "Add Entity Type",
        "description": "Add a new entity type to the collection (append-only, requires moderator/admin)",
        "tags": [
          "Selections"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "tag": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 100
                  }
                },
                "required": [
                  "tag"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Entity type added successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "entityTypes": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  },
                  "required": [
                    "success",
                    "entityTypes"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Moderator or Admin access required",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/entity-types/bulk": {
      "post": {
        "summary": "Bulk Add Entity Types",
        "description": "Add multiple entity types to the collection (append-only, requires moderator/admin)",
        "tags": [
          "Selections"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "tags": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 100
                    }
                  }
                },
                "required": [
                  "tags"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Entity types added successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "entityTypes": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  },
                  "required": [
                    "success",
                    "entityTypes"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Moderator or Admin access required",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "error"
                  ]
                }
              }
            }
          }
        }
      }
    }
  },
  "webhooks": {}
}